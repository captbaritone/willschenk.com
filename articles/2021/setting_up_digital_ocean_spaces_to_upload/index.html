<!doctype html><html><head><title>Setting up digital ocean spaces to upload</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=../../../css/theme.css><link rel=stylesheet href=../../../css/syntax.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-56296045-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script async defer data-domain=willschenk.com src=https://plausible.io/js/plausible.js></script><meta property="og:title" content="Setting up digital ocean spaces to upload"><meta property="og:description" content="Setup the space  Config and keys   First go and create a new space.  Then generate a new spaces accesskey.  Then create a .env file that contains the following variables.    AWS_ACCESS_KEY_ID From digital ocean   AWS_SECRET_ACCESS_KEY From digitial ocean   AWS_END_POINT From the settings tab of your space   BUCKET_NAME Name of the bucket     My end point is nyc3."><meta property="og:type" content="article"><meta property="og:url" content="https://willschenk.com/articles/2021/setting_up_digital_ocean_spaces_to_upload/"><meta property="article:published_time" content="2021-12-17T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-17T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setting up digital ocean spaces to upload"><meta name=twitter:description content="Setup the space  Config and keys   First go and create a new space.  Then generate a new spaces accesskey.  Then create a .env file that contains the following variables.    AWS_ACCESS_KEY_ID From digital ocean   AWS_SECRET_ACCESS_KEY From digitial ocean   AWS_END_POINT From the settings tab of your space   BUCKET_NAME Name of the bucket     My end point is nyc3."><meta name=twitter:site content="@wschenk"><style>.article p,.article ul,.article ol,.article table{max-width:45em}.article pre p{max-width:none;margin-top:-1.5rem}article.article p:first-child,.article blockquote{font-size:1.25em;font-weight:300;max-width:36em}.half-height-scroll{max-height:32em;overflow:scroll}</style></head><body><nav class="container my-5"><h1 class="pt-md-5 display-3"><a class=text-dark href=../../../>Will Schenk</a></h1><p><a class="text-dark h4 mr-3 font-weight-light" href=../../../articles/>Articles</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../contact>Contact</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../tags/>Tags</a>
<a href=../../../feed.xml class="mr-3 h4 text-light"><img src=../../../img/rss.svg alt=rss height=20 width=20></a>
<a href=https://twitter.com/@wschenk class="mr-3 h4 text-light"><img src=../../../img/twitter.svg alt=twitter height=20 width=20></a>
<a href=https://instagram.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/instagram.svg alt=instagram height=20 width=20></a>
<a href=https://github.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/github.svg alt=github height=20 width=20></a>
<a href=https://linkedin.com/in/will-schenk-420266 class="mr-3 h4 text-light"><img src=../../../img/linkedin.svg alt=linkedin height=20 width=20></a></p></nav><div class=container><h1 class=mt-5>Setting up digital ocean spaces to upload</h1><p class="text-muted mt-3"><a class=text-muted href=https://willschenk.com/articles/2021/setting_up_digital_ocean_spaces_to_upload/>Published December 17, 2021</a>
<a class=text-muted href=../../../tags/aws>#aws,</a>
<a class=text-muted href=../../../tags/s3>#s3,</a>
<a class=text-muted href=../../../tags/ruby>#ruby,</a>
<a class=text-muted href=../../../tags/node>#node,</a>
<a class=text-muted href=../../../tags/golang>#golang,</a>
<a class=text-muted href=../../../tags/deno>#deno,</a>
<a class=text-muted href=../../../tags/digitalocean>#digitalocean</a></p><article class="article mt-5"><h2 id=headline-1>Setup the space</h2><h3 id=headline-2>Config and keys</h3><p>First go and <a href=https://cloud.digitalocean.com/spaces/new>create a new space</a>.</p><p>Then generate a <a href=https://cloud.digitalocean.com/account/api/tokens>new spaces accesskey</a>.</p><p>Then create a <code class=verbatim>.env</code> file that contains the following variables.</p><table><tbody><tr><td><code class=verbatim>AWS_ACCESS_KEY_ID</code></td><td>From digital ocean</td></tr><tr><td><code class=verbatim>AWS_SECRET_ACCESS_KEY</code></td><td>From digitial ocean</td></tr><tr><td><code class=verbatim>AWS_END_POINT</code></td><td>From the settings tab of your space</td></tr><tr><td><code class=verbatim>BUCKET_NAME</code></td><td>Name of the bucket</td></tr></tbody></table><p>My end point is <em>nyc3.digitaloceanspaces.com</em></p><p>If you need to set a region, I pass in <code class=verbatim>us-east-1</code> which seemed to work.</p><h3 id=headline-3>(Optional) Putting the config inside of a kubernetes</h3><p>Just for my future reference</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  kubectl create configmap s3-access --from-env-file<span class=o>=</span>.env</code></pre></div></div><h2 id=headline-4>CDN and DNS</h2><p>Enable the <a href=https://docs.digitalocean.com/products/spaces/how-to/enable-cdn/>CDN as documented here</a>. This works if you have a digital ocean hosted domain.</p><p>I added a letencrypt cert to a subdomain, and everything zipped right
along.</p><h2 id=headline-5>Upload with ruby</h2><p>I'm using inline gems here so you don't need to create a <code class=verbatim>Gemfile</code></p><div class="src src-ruby"><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby>  <span class=nb>require</span> <span class=s1>&#39;bundler/inline&#39;</span>

  <span class=n>gemfile</span> <span class=k>do</span>
    <span class=n>source</span> <span class=s1>&#39;https://rubygems.org&#39;</span>

    <span class=n>gem</span> <span class=s2>&#34;aws-sdk-s3&#34;</span><span class=p>,</span> <span class=s2>&#34;~&gt; 1.100&#34;</span>
    <span class=n>gem</span> <span class=s2>&#34;rexml&#34;</span><span class=p>,</span> <span class=s2>&#34;~&gt; 3.2&#34;</span>
    <span class=n>gem</span> <span class=s2>&#34;dotenv&#34;</span>
  <span class=k>end</span>

  <span class=no>Dotenv</span><span class=o>.</span><span class=n>load</span>

  <span class=o>[</span><span class=s1>&#39;AWS_ACCESS_KEY_ID&#39;</span><span class=p>,</span> <span class=s1>&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span class=p>,</span> <span class=s1>&#39;AWS_END_POINT&#39;</span><span class=p>,</span> <span class=s1>&#39;BUCKET_NAME&#39;</span><span class=o>].</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>key</span><span class=o>|</span>
    <span class=kp>throw</span> <span class=s2>&#34;Set </span><span class=si>#{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>if</span> <span class=no>ENV</span><span class=o>[</span><span class=n>key</span><span class=o>].</span><span class=n>nil?</span>
  <span class=k>end</span>

  <span class=n>region</span> <span class=o>=</span> <span class=s1>&#39;us-east-1&#39;</span>
  <span class=n>s3_client</span> <span class=o>=</span> <span class=no>Aws</span><span class=o>::</span><span class=no>S3</span><span class=o>::</span><span class=no>Client</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>access_key_id</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s1>&#39;AWS_ACCESS_KEY_ID&#39;</span><span class=o>]</span><span class=p>,</span>
                                  <span class=ss>secret_access_key</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s1>&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span class=o>]</span><span class=p>,</span>
                                  <span class=ss>endpoint</span><span class=p>:</span> <span class=s2>&#34;https://</span><span class=si>#{</span><span class=no>ENV</span><span class=o>[</span><span class=s1>&#39;AWS_END_POINT&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
                                  <span class=ss>region</span><span class=p>:</span> <span class=n>region</span><span class=p>)</span>

  <span class=n>file_name</span> <span class=o>=</span> <span class=vg>$0</span>

  <span class=n>response</span> <span class=o>=</span> <span class=n>s3_client</span><span class=o>.</span><span class=n>put_object</span><span class=p>(</span>
    <span class=ss>body</span><span class=p>:</span> <span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>file_name</span><span class=p>),</span>
    <span class=ss>bucket</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s1>&#39;BUCKET_NAME&#39;</span><span class=o>]</span><span class=p>,</span>
    <span class=ss>key</span><span class=p>:</span> <span class=n>file_name</span><span class=p>,</span>
    <span class=ss>acl</span><span class=p>:</span> <span class=s1>&#39;public-read&#39;</span><span class=p>,</span>
    <span class=ss>content_type</span><span class=p>:</span> <span class=s1>&#39;text/plain&#39;</span>
  <span class=p>)</span>

  <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>etag</span>
    <span class=nb>puts</span> <span class=s2>&#34;Uploaded at </span><span class=si>#{</span><span class=n>response</span><span class=o>.</span><span class=n>etag</span><span class=si>}</span><span class=s2>&#34;</span>
    <span class=nb>p</span> <span class=n>response</span>
    <span class=nb>exit</span> <span class=mi>0</span>
  <span class=k>else</span>
    <span class=nb>puts</span> <span class=s2>&#34;Not uploaded&#34;</span>
    <span class=nb>exit</span> <span class=mi>1</span>
  <span class=k>end</span></code></pre></div></div><h2 id=headline-6>Upload with node</h2><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npm install awk-sdk dotenv detect-content-type</code></pre></div></div><p><code class=verbatim>upload.js</code>:</p><div class="src src-javascript"><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript>  <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;dotenv&#39;</span><span class=p>).</span><span class=nx>config</span><span class=p>()</span>
  <span class=kr>const</span> <span class=nx>detectContentType</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;detect-content-type&#39;</span><span class=p>)</span>

  <span class=kr>const</span> <span class=nx>AWS</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;aws-sdk&#39;</span><span class=p>);</span>
  <span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span> <span class=c1>// Needed for example below
</span><span class=c1></span>
  <span class=kr>const</span> <span class=nx>spacesEndpoint</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AWS</span><span class=p>.</span><span class=nx>Endpoint</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>AWS_END_POINT</span><span class=p>);</span>
  <span class=kr>const</span> <span class=nx>s3</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AWS</span><span class=p>.</span><span class=nx>S3</span><span class=p>({</span>
      <span class=nx>endpoint</span><span class=o>:</span> <span class=nx>spacesEndpoint</span><span class=p>,</span>
      <span class=nx>accessKeyId</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>AWS_ACCESS_KEY_ID</span><span class=p>,</span>
      <span class=nx>secretAccessKey</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>AWS_SECRET_ACCESS_KEY</span>
  <span class=p>});</span>

  <span class=kr>const</span> <span class=nx>uploadFile</span> <span class=o>=</span> <span class=p>(</span><span class=nx>fileName</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// Read content from the file
</span><span class=c1></span>      <span class=kr>const</span> <span class=nx>fileContent</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=nx>fileName</span><span class=p>);</span>

      <span class=kr>const</span> <span class=nx>ct</span> <span class=o>=</span> <span class=nx>detectContentType</span><span class=p>(</span><span class=nx>fileContent</span><span class=p>)</span>

      <span class=kd>var</span> <span class=nx>params</span> <span class=o>=</span> <span class=p>{</span>
          <span class=nx>Bucket</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>BUCKET_NAME</span><span class=p>,</span>
          <span class=nx>Key</span><span class=o>:</span> <span class=nx>fileName</span><span class=p>,</span>
          <span class=nx>Body</span><span class=o>:</span> <span class=nx>fileContent</span><span class=p>,</span>
          <span class=nx>ACL</span><span class=o>:</span> <span class=s2>&#34;public-read&#34;</span><span class=p>,</span>
          <span class=nx>ContentType</span><span class=o>:</span> <span class=nx>ct</span><span class=p>,</span>
      <span class=p>};</span>

      <span class=nx>s3</span><span class=p>.</span><span class=nx>putObject</span><span class=p>(</span><span class=nx>params</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>err</span><span class=p>.</span><span class=nx>stack</span><span class=p>);}</span>
          <span class=k>else</span>     <span class=p>{</span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>);}</span>
      <span class=p>});</span>
  <span class=p>}</span>

  <span class=nx>uploadFile</span><span class=p>(</span> <span class=s2>&#34;upload.js&#34;</span> <span class=p>);</span>
</code></pre></div></div><h2 id=headline-7>Upload with go</h2><p>Setup the environment:</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  go mod init gitgratitude.com
  go get github.com/aws/aws-sdk-go/aws                 
  go get github.com/aws/aws-sdk-go/aws/awsutil@v1.42.23
  go get github.com/joho/godotenv</code></pre></div></div><p>Then <code class=verbatim>upload.go</code>:</p><div class="src src-go"><div class=highlight><pre class=chroma><code class=language-go data-lang=go>  <span class=kn>package</span> <span class=nx>main</span>

  <span class=kn>import</span> <span class=p>(</span>
    <span class=s>&#34;bytes&#34;</span>
    <span class=s>&#34;fmt&#34;</span>
    <span class=s>&#34;log&#34;</span>
    <span class=s>&#34;net/http&#34;</span>
    <span class=s>&#34;os&#34;</span>

    <span class=s>&#34;github.com/aws/aws-sdk-go/aws&#34;</span>
    <span class=s>&#34;github.com/aws/aws-sdk-go/aws/credentials&#34;</span>
    <span class=s>&#34;github.com/aws/aws-sdk-go/aws/session&#34;</span>
    <span class=s>&#34;github.com/aws/aws-sdk-go/service/s3&#34;</span>
    <span class=s>&#34;github.com/joho/godotenv&#34;</span>
  <span class=p>)</span>

  <span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=nx>err</span> <span class=o>:=</span> <span class=nx>godotenv</span><span class=p>.</span><span class=nf>Load</span><span class=p>()</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
      <span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=s>&#34;Error loading .env file&#34;</span><span class=p>)</span>
    <span class=p>}</span>

    <span class=nx>s3Config</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>aws</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
      <span class=nx>Credentials</span><span class=p>:</span> <span class=nx>credentials</span><span class=p>.</span><span class=nf>NewStaticCredentials</span><span class=p>(</span>
        <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;AWS_ACCESS_KEY_ID&#34;</span><span class=p>),</span>
        <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;AWS_SECRET_ACCESS_KEY&#34;</span><span class=p>),</span>
        <span class=s>&#34;&#34;</span><span class=p>),</span>
      <span class=nx>Endpoint</span><span class=p>:</span> <span class=nx>aws</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;https://&#34;</span> <span class=o>+</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;AWS_END_POINT&#34;</span><span class=p>)),</span>
      <span class=nx>Region</span><span class=p>:</span>   <span class=nx>aws</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;us-east-1&#34;</span><span class=p>),</span>
    <span class=p>}</span>

    <span class=nx>newSession</span> <span class=o>:=</span> <span class=nx>session</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>s3Config</span><span class=p>)</span>
    <span class=nx>s3Client</span> <span class=o>:=</span> <span class=nx>s3</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>newSession</span><span class=p>)</span>

    <span class=nx>fileName</span> <span class=o>:=</span> <span class=s>&#34;upload.go&#34;</span>

    <span class=nx>file</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=nx>fileName</span><span class=p>)</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
      <span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
    <span class=p>}</span>

    <span class=k>defer</span> <span class=nx>file</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>

    <span class=c1>// Get file size and read the file content into a buffer
</span><span class=c1></span>    <span class=nx>fileInfo</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>file</span><span class=p>.</span><span class=nf>Stat</span><span class=p>()</span>
    <span class=kd>var</span> <span class=nx>size</span> <span class=kt>int64</span> <span class=p>=</span> <span class=nx>fileInfo</span><span class=p>.</span><span class=nf>Size</span><span class=p>()</span>
    <span class=nx>buffer</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=nx>size</span><span class=p>)</span>
    <span class=nx>file</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=nx>buffer</span><span class=p>)</span>

    <span class=nx>object</span> <span class=o>:=</span> <span class=nx>s3</span><span class=p>.</span><span class=nx>PutObjectInput</span><span class=p>{</span>
      <span class=nx>Bucket</span><span class=p>:</span>             <span class=nx>aws</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;BUCKET_NAME&#34;</span><span class=p>)),</span>
      <span class=nx>Key</span><span class=p>:</span>                <span class=nx>aws</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=nx>fileName</span><span class=p>),</span>
      <span class=nx>Body</span><span class=p>:</span>               <span class=nx>bytes</span><span class=p>.</span><span class=nf>NewReader</span><span class=p>(</span><span class=nx>buffer</span><span class=p>),</span>
      <span class=nx>ContentLength</span><span class=p>:</span>      <span class=nx>aws</span><span class=p>.</span><span class=nf>Int64</span><span class=p>(</span><span class=nx>size</span><span class=p>),</span>
      <span class=nx>ContentType</span><span class=p>:</span>        <span class=nx>aws</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>DetectContentType</span><span class=p>(</span><span class=nx>buffer</span><span class=p>)),</span>
      <span class=nx>ContentDisposition</span><span class=p>:</span> <span class=nx>aws</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;attachment&#34;</span><span class=p>),</span>
      <span class=nx>ACL</span><span class=p>:</span>                <span class=nx>aws</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;public-read&#34;</span><span class=p>),</span>
    <span class=p>}</span>

    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%v\n&#34;</span><span class=p>,</span> <span class=nx>object</span><span class=p>)</span>
    <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>s3Client</span><span class=p>.</span><span class=nf>PutObject</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>object</span><span class=p>)</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
      <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
    <span class=p>}</span>
  <span class=p>}</span></code></pre></div></div><h2 id=headline-8>Upload with deno</h2><div class="src src-javascript"><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>config</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;https://deno.land/x/dotenv/mod.ts&#34;</span><span class=p>;</span>
  <span class=kr>import</span> <span class=p>{</span> <span class=nx>S3</span><span class=p>,</span> <span class=nx>S3Bucket</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;https://deno.land/x/s3@0.5.0/mod.ts&#34;</span><span class=p>;</span>

  <span class=kr>const</span> <span class=nx>s3</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>S3</span><span class=p>({</span>
      <span class=nx>accessKeyID</span><span class=o>:</span> <span class=nx>config</span><span class=p>().</span><span class=nx>AWS_ACCESS_KEY_ID</span><span class=p>,</span>
      <span class=nx>secretKey</span><span class=o>:</span> <span class=nx>config</span><span class=p>().</span><span class=nx>AWS_SECRET_ACCESS_KEY</span><span class=p>,</span>
      <span class=nx>region</span><span class=o>:</span> <span class=s2>&#34;us-east-1&#34;</span><span class=p>,</span>
      <span class=nx>endpointURL</span><span class=o>:</span> <span class=sb>`https://</span><span class=si>${</span><span class=nx>config</span><span class=p>().</span><span class=nx>AWS_END_POINT</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
    <span class=p>});</span>

  <span class=kr>const</span> <span class=nx>bucket</span> <span class=o>=</span> <span class=nx>s3</span><span class=p>.</span><span class=nx>getBucket</span><span class=p>(</span><span class=nx>config</span><span class=p>().</span><span class=nx>BUCKET_NAME</span><span class=p>);</span>

  <span class=kr>const</span> <span class=nx>fileName</span> <span class=o>=</span> <span class=s1>&#39;upload.deno.js&#39;</span>

  <span class=kr>const</span> <span class=nx>text</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>Deno</span><span class=p>.</span><span class=nx>readTextFile</span><span class=p>(</span><span class=nx>fileName</span><span class=p>);</span>

  <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>bucket</span><span class=p>.</span><span class=nx>putObject</span><span class=p>(</span><span class=nx>fileName</span><span class=p>,</span> <span class=nx>text</span><span class=p>,</span> <span class=p>{</span>
      <span class=nx>contentType</span><span class=o>:</span> <span class=s2>&#34;text/plain&#34;</span><span class=p>,</span>
      <span class=nx>acl</span><span class=o>:</span> <span class=s2>&#34;public-read&#34;</span>
    <span class=p>});</span>
  
  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span> <span class=nx>result</span> <span class=p>)</span>
</code></pre></div></div><h2 id=headline-9>References</h2><ol><li><p><a href=https://docs.digitalocean.com/products/spaces/resources/s3-sdk-examples/>https://docs.digitalocean.com/products/spaces/resources/s3-sdk-examples/</a></p></li><li><p><a href=https://docs.digitalocean.com/products/spaces/how-to/manage-access/>https://docs.digitalocean.com/products/spaces/how-to/manage-access/</a></p></li></ol></article></div><div class="bg-light py-5"><div class=container><h2 class=text-center>Read next</h2><div class=row><div class="col-md-6 text-center"></div><div class="col-md-6 text-center">Previous Post:
<a href=../../../articles/2021/receiving_cloud_events_with_next_js/>Receiving CloudEvents with NextJS</a></div></div></div></div><div class="container mt-5"><h2 class=text-center>See also</h2><div class=row><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/uploading_to_s3_on_the_command_line/>Uploading to S3 on the command line</a></p><p class="lead font-italic mb-0">throwing data into a bucket</p><div class="font-weight-light mt-3"><p>I want to store data from a shell scripts on a S3 compatible bucket from with in a docker container. I'm going to be doing this on digital ocean, but I assume that any API compatible service would work. Setup spaces in digital ocean I'm going to be using digital ocean for these tests, and I setup my bucket with the following terraform snippet. resource "digitalocean_spaces_bucket" "gratitude-public" { name = "gratitude-public" region = "nyc3" cors_rule { allowed_headers = ["*"] allowed_methods = ["GET"] allowed_origins = ["*"] max_age_seconds = 3000 } } Environment Variables AWS_ACCESS_KEY_ID spaces id AWS_SECRET_ACCESS_KEY access key AWS_END_POINT nyc3.</p></div><a href=../../../articles/2021/uploading_to_s3_on_the_command_line/ class="btn btn-primary">Read more</a></div><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/controlling_docker_in_golang/>Controlling docker in golang</a></p><p class="lead font-italic mb-0">So meta</p><div class="font-weight-light mt-3"><p>I've been thinking about running different ephemeral jobs with attached volumes, volumes that I could garbage collect as needed. This is a non-standard way of using docker, but I wanted to look to see how I could interact with the docker daemon programatically. The use case is: Create a docker volume for a container Start up a docker container, with a specified environment Monitor the running of the container, kill if its running for too long Capture the output of the container Clean up the container Pull data from the volume Clean up the volume Setting up go environemnt First we need to setup a go project and create the go.</p></div><a href=../../../articles/2021/controlling_docker_in_golang/ class="btn btn-primary">Read more</a></div><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/sq_lite_in_the_browser/>SQLite in the browser</a></p><p class="lead font-italic mb-0">pushing everything to the client</p><div class="font-weight-light mt-3"><p>I'm getting more interested in SQLite as a database, keeping everything in memory to the process itself. When do we actually need to have a multi-process solution for a website? How much can we really do within a single process? One type of architecture I'm exploring is to have a zillion little sqlite files that are shipped around as needed, rather than providing an API to parse them out have one way where we can generate a bunch of effectively static assets of the structured data and then having the visualization happen on the client side.</p></div><a href=../../../articles/2021/sq_lite_in_the_browser/ class="btn btn-primary">Read more</a></div></div></div><footer class="footer bg-dark text-light mt-3"><div class=container><h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2></div></footer></body></html>