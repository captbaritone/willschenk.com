<!doctype html><html><head><title>Receiving CloudEvents with NextJS</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=../../../css/theme.css><link rel=stylesheet href=../../../css/syntax.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-56296045-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script async defer data-domain=willschenk.com src=https://plausible.io/js/plausible.js></script><meta property="og:title" content="Receiving CloudEvents with NextJS"><meta property="og:description" content="Need to receive cloudevents from your NextJS app? Me too! You need next-runtime. Install  npm i next-runtime cloudevents  In pages/indes.ts   And then: import { handle, json } from 'next-runtime'; import { HTTP } from 'cloudevents'; export const getServerSideProps = handle({ async post({ req }) { console.log( req.body ) console.log( req.headers ) const receivedEvent = HTTP.toEvent({headers: req.headers, body: req.body }) console.log( receivedEvent ) return json({ message: 'Thanks for your submission!"><meta property="og:type" content="article"><meta property="og:url" content="https://willschenk.com/articles/2021/receiving_cloud_events_with_next_js/"><meta property="article:published_time" content="2021-12-15T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Receiving CloudEvents with NextJS"><meta name=twitter:description content="Need to receive cloudevents from your NextJS app? Me too! You need next-runtime. Install  npm i next-runtime cloudevents  In pages/indes.ts   And then: import { handle, json } from 'next-runtime'; import { HTTP } from 'cloudevents'; export const getServerSideProps = handle({ async post({ req }) { console.log( req.body ) console.log( req.headers ) const receivedEvent = HTTP.toEvent({headers: req.headers, body: req.body }) console.log( receivedEvent ) return json({ message: 'Thanks for your submission!"><meta name=twitter:site content="@wschenk"><style>.article p,.article ul,.article ol,.article table{max-width:45em}.article pre p{max-width:none;margin-top:-1.5rem}article.article p:first-child,.article blockquote{font-size:1.25em;font-weight:300;max-width:36em}.half-height-scroll{max-height:32em;overflow:scroll}</style></head><body><nav class="container my-5"><h1 class="pt-md-5 display-3"><a class=text-dark href=../../../>Will Schenk</a></h1><p><a class="text-dark h4 mr-3 font-weight-light" href=../../../articles/>Articles</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../contact>Contact</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../tags/>Tags</a>
<a href=../../../feed.xml class="mr-3 h4 text-light"><img src=../../../img/rss.svg alt=rss height=20 width=20></a>
<a href=https://twitter.com/@wschenk class="mr-3 h4 text-light"><img src=../../../img/twitter.svg alt=twitter height=20 width=20></a>
<a href=https://instagram.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/instagram.svg alt=instagram height=20 width=20></a>
<a href=https://github.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/github.svg alt=github height=20 width=20></a>
<a href=https://linkedin.com/in/will-schenk-420266 class="mr-3 h4 text-light"><img src=../../../img/linkedin.svg alt=linkedin height=20 width=20></a></p></nav><div class=container><h1 class=mt-5>Receiving CloudEvents with NextJS</h1><p class="text-muted mt-3"><a class=text-muted href=https://willschenk.com/articles/2021/receiving_cloud_events_with_next_js/>Published December 15, 2021</a>
<a class=text-muted href=../../../tags/nextjs>#nextjs,</a>
<a class=text-muted href=../../../tags/knative>#knative,</a>
<a class=text-muted href=../../../tags/cloudevents>#cloudevents</a></p><article class="article mt-5"><p>Need to receive <a href=https://cloudevents.io/>cloudevents</a> from your <a href=https://nextjs.org/>NextJS</a> app? Me too! You need <a href=https://github.com/smeijer/next-runtime>next-runtime</a>.</p><h2 id=headline-1>Install</h2><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npm i next-runtime cloudevents</code></pre></div></div><h2 id=headline-2>In <code class=verbatim>pages/indes.ts</code></h2><p>And then:</p><div class="src src-typescript"><div class=highlight><pre class=chroma><code class=language-typescript data-lang=typescript>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>handle</span><span class=p>,</span> <span class=nx>json</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;next-runtime&#39;</span><span class=p>;</span>
  <span class=kr>import</span> <span class=p>{</span> <span class=nx>HTTP</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;cloudevents&#39;</span><span class=p>;</span>

  <span class=kr>export</span> <span class=kr>const</span> <span class=nx>getServerSideProps</span> <span class=o>=</span> <span class=nx>handle</span><span class=p>({</span>
      <span class=nx>async</span> <span class=nx>post</span><span class=p>({</span> <span class=nx>req</span> <span class=p>})</span> <span class=p>{</span>
          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span> <span class=p>)</span>
          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span> <span class=p>)</span>
        
          <span class=kr>const</span> <span class=nx>receivedEvent</span> <span class=o>=</span> <span class=nx>HTTP</span><span class=p>.</span><span class=nx>toEvent</span><span class=p>({</span><span class=nx>headers</span>: <span class=kt>req.headers</span><span class=p>,</span> <span class=nx>body</span>: <span class=kt>req.body</span> <span class=p>})</span>
          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span> <span class=nx>receivedEvent</span> <span class=p>)</span>
          <span class=k>return</span> <span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Thanks for your submission!&#39;</span> <span class=p>});</span>
      <span class=p>},</span>
      <span class=nx>async</span> <span class=nx>get() {</span>
          <span class=k>return</span> <span class=nx>json</span><span class=p>(</span> <span class=p>{</span><span class=nx>message</span><span class=o>:</span><span class=s2>&#34;ok&#34;</span><span class=p>}</span> <span class=p>)</span>
      <span class=p>}</span>
  <span class=p>}))</span>
</code></pre></div></div><p>Took me a while to sort out, but it wasn't so hard. Thanks <a href=https://twitter.com/meijer_s>meijer_s</a>!</p></article></div><div class="bg-light py-5"><div class=container><h2 class=text-center>Read next</h2><div class=row><div class="col-md-6 text-center">Next Post:
<a href=../../../articles/2021/setting_up_digital_ocean_spaces_to_upload/>Setting up digital ocean spaces to upload</a></div><div class="col-md-6 text-center">Previous Post:
<a href=../../../articles/2021/setting_up_knative_eventing/>Setting up knative eventing</a></div></div></div></div><div class="container mt-5"><h2 class=text-center>See also</h2><div class=row><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/next_js_with_prisma/>NextJS with Prisma on Kubernetes</a></p><p class="lead font-italic mb-0">deploy as a knative service</p><div class="font-weight-light mt-3"><p>Now that we have our cluster up and running, lets look at how to build and deploy a NextJS app on it, including the database. Create a NextJS app We'll scaffold out a TypeScript app. npx create-next-app@latest --typescript myapp cd myapp npm run dev Fireup a local data docker run -e POSTGRES_PASSWORD=awesome_password -p 5432:5432 postgres Install prisma We'll add the npm packages to our project.</p></div><a href=../../../articles/2021/next_js_with_prisma/ class="btn btn-primary">Read more</a></div><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/setting_up_knative_eventing/>Setting up knative eventing</a></p><p class="lead font-italic mb-0">lets send some messages</p><div class="font-weight-light mt-3"><p>Here's a walk through of how to setup knative eventing. I couldn't find this information in one place and it took longer than I expected to sort it out. There are a couple of ways you can use eventing. One is to sent messages directly to specific services. This I outline walk through as a direct event. Another is to use a broker and a trigger. A broker is basically the place you send stuff to, and then you define specific listeners by creating a trigger.</p></div><a href=../../../articles/2021/setting_up_knative_eventing/ class="btn btn-primary">Read more</a></div><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/serving_a_knative_function_on_the_root/>Serving a knative function on the root</a></p><p class="lead font-italic mb-0">root to services</p><div class="font-weight-light mt-3"><p>I want to deploy everything as a knative service, including the root of the domain. Update: I found an easyier way. Easy way Turn on auto-tls and autocreate-cluster-domain-claims: kubectl patch configmap config-network --namespace knative-serving -p '{"data":{"auto-tls":"Enabled","autocreate-cluster-domain-claims":"true"}}' Then kn domain create gitgratitude.com --ref=homepage That's it. Hardway Left here for the record. Add ingress-nginx helm upgrade --install ingress-nginx ingress-nginx \ --repo https://kubernetes.</p></div><a href=../../../articles/2021/serving_a_knative_function_on_the_root/ class="btn btn-primary">Read more</a></div></div></div><footer class="footer bg-dark text-light mt-3"><div class=container><h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2></div></footer></body></html>