<!doctype html><html><head><title>Uploading to S3 on the command line</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=../../../css/theme.css><link rel=stylesheet href=../../../css/syntax.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-56296045-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script async defer data-domain=willschenk.com src=https://plausible.io/js/plausible.js></script><meta property="og:title" content="Uploading to S3 on the command line"><meta property="og:description" content="I want to store data from a shell scripts on a S3 compatible bucket from with in a docker container.  I'm going to be doing this on digital ocean, but I assume that any API compatible service would work. Setup spaces in digital ocean   I'm going to be using digital ocean for these tests, and I setup my bucket with the following terraform snippet. resource &#34;digitalocean_spaces_bucket&#34; &#34;gratitude-public&#34; { name = &#34;gratitude-public&#34; region = &#34;nyc3&#34; cors_rule { allowed_headers = [&#34;*&#34;] allowed_methods = [&#34;GET&#34;] allowed_origins = [&#34;*&#34;] max_age_seconds = 3000 } }  Environment Variables     AWS_ACCESS_KEY_ID spaces id   AWS_SECRET_ACCESS_KEY access key   AWS_END_POINT nyc3."><meta property="og:type" content="article"><meta property="og:url" content="https://willschenk.com/articles/2021/uploading_to_s3_on_the_command_line/"><meta property="article:published_time" content="2021-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2021-08-22T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Uploading to S3 on the command line"><meta name=twitter:description content="I want to store data from a shell scripts on a S3 compatible bucket from with in a docker container.  I'm going to be doing this on digital ocean, but I assume that any API compatible service would work. Setup spaces in digital ocean   I'm going to be using digital ocean for these tests, and I setup my bucket with the following terraform snippet. resource &#34;digitalocean_spaces_bucket&#34; &#34;gratitude-public&#34; { name = &#34;gratitude-public&#34; region = &#34;nyc3&#34; cors_rule { allowed_headers = [&#34;*&#34;] allowed_methods = [&#34;GET&#34;] allowed_origins = [&#34;*&#34;] max_age_seconds = 3000 } }  Environment Variables     AWS_ACCESS_KEY_ID spaces id   AWS_SECRET_ACCESS_KEY access key   AWS_END_POINT nyc3."><meta name=twitter:site content="@wschenk"><style>.article p,.article ul,.article ol,.article table{max-width:45em}.article pre p{max-width:none;margin-top:-1.5rem}article.article p:first-child,.article blockquote{font-size:1.25em;font-weight:300;max-width:36em}.half-height-scroll{max-height:32em;overflow:scroll}</style></head><body><nav class="container my-5"><h1 class="pt-md-5 display-3"><a class=text-dark href=../../../>Will Schenk</a></h1><p><a class="text-dark h4 mr-3 font-weight-light" href=../../../articles/>Articles</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../contact>Contact</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../tags/>Tags</a>
<a href=../../../feed.xml class="mr-3 h4 text-light"><img src=../../../img/rss.svg alt=rss height=20 width=20></a>
<a href=https://twitter.com/@wschenk class="mr-3 h4 text-light"><img src=../../../img/twitter.svg alt=twitter height=20 width=20></a>
<a href=https://instagram.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/instagram.svg alt=instagram height=20 width=20></a>
<a href=https://github.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/github.svg alt=github height=20 width=20></a>
<a href=https://linkedin.com/in/will-schenk-420266 class="mr-3 h4 text-light"><img src=../../../img/linkedin.svg alt=linkedin height=20 width=20></a></p></nav><div class=container><h1 class=mt-5>Uploading to S3 on the command line</h1><h2 class="font-weight-light font-italic mb-3">throwing data into a bucket</h2><p class="text-muted mt-3"><a class=text-muted href=https://willschenk.com/articles/2021/uploading_to_s3_on_the_command_line/>Published August 22, 2021</a>
<a class=text-muted href=../../../tags/bash>#bash,</a>
<a class=text-muted href=../../../tags/ruby>#ruby,</a>
<a class=text-muted href=../../../tags/s3>#s3,</a>
<a class=text-muted href=../../../tags/spaces>#spaces,</a>
<a class=text-muted href=../../../tags/curl>#curl</a></p><article class="article mt-5"><p>I want to store data from a shell scripts on a S3 compatible bucket
from with in a docker container.</p><p>I'm going to be doing this on digital ocean, but I assume that any API
compatible service would work.</p><h2 id=headline-1>Setup spaces in digital ocean</h2><p>I'm going to be using digital ocean for these tests, and I setup my
bucket with the following terraform snippet.</p><div class="src src-terraform"><div class=highlight><pre class=chroma><code class=language-terraform data-lang=terraform>  <span class=kr>resource</span> <span class=s>&#34;digitalocean_spaces_bucket&#34; &#34;gratitude-public&#34;</span> {
<span class=na>    name</span>   <span class=o>=</span> <span class=s2>&#34;gratitude-public&#34;</span>
<span class=na>    region</span> <span class=o>=</span> <span class=s2>&#34;nyc3&#34;</span>

    <span class=err>cors_rule</span> {
<span class=na>      allowed_headers</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>]</span>
<span class=na>      allowed_methods</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;GET&#34;</span><span class=p>]</span>
<span class=na>      allowed_origins</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>]</span>
<span class=na>      max_age_seconds</span> <span class=o>=</span> <span class=m>3000</span>
    }
  }</code></pre></div></div><h2 id=headline-2>Environment Variables</h2><table><tbody><tr><td><code class=verbatim>AWS_ACCESS_KEY_ID</code></td><td>spaces id</td></tr><tr><td><code class=verbatim>AWS_SECRET_ACCESS_KEY</code></td><td>access key</td></tr><tr><td><code class=verbatim>AWS_END_POINT</code></td><td><code class=verbatim>nyc3.digitaloceanspaces.com</code></td></tr><tr><td><code class=verbatim>BUCKET_NAME</code></td><td>the bucket name</td></tr></tbody></table><h2 id=headline-3>Using ruby</h2><p>We'll first look at how to make a simple script to upload a file using
a self contained ruby script.</p><div class="src src-ruby"><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby>  <span class=nb>require</span> <span class=s1>&#39;bundler/inline&#39;</span>

  <span class=n>gemfile</span> <span class=k>do</span>
    <span class=n>source</span> <span class=s1>&#39;https://rubygems.org&#39;</span>
    <span class=n>gem</span> <span class=s1>&#39;aws-sdk-s3&#39;</span>
    <span class=n>gem</span> <span class=s1>&#39;rexml&#39;</span>
  <span class=k>end</span>

  <span class=k>def</span> <span class=nf>upload_object</span><span class=p>(</span><span class=n>s3_client</span><span class=p>,</span> <span class=n>bucket_name</span><span class=p>,</span> <span class=n>file_name</span><span class=p>)</span>
    <span class=n>response</span> <span class=o>=</span> <span class=n>s3_client</span><span class=o>.</span><span class=n>put_object</span><span class=p>(</span>
      <span class=ss>body</span><span class=p>:</span> <span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>file_name</span><span class=p>),</span>
      <span class=ss>bucket</span><span class=p>:</span> <span class=n>bucket_name</span><span class=p>,</span>
      <span class=ss>key</span><span class=p>:</span> <span class=n>file_name</span><span class=p>,</span>
      <span class=ss>acl</span><span class=p>:</span> <span class=s1>&#39;public-read&#39;</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>etag</span>
      <span class=k>return</span> <span class=kp>true</span>
    <span class=k>else</span>
      <span class=k>return</span> <span class=kp>false</span>
    <span class=k>end</span>
  <span class=k>rescue</span> <span class=no>StandardError</span> <span class=o>=&gt;</span> <span class=n>e</span>
    <span class=nb>puts</span> <span class=s2>&#34;Error uploading object: </span><span class=si>#{</span><span class=n>e</span><span class=o>.</span><span class=n>message</span><span class=si>}</span><span class=s2>&#34;</span>
    <span class=k>return</span> <span class=kp>false</span>
  <span class=k>end</span>

  <span class=k>def</span> <span class=nf>run_me</span>
    <span class=o>[</span><span class=s1>&#39;AWS_ACCESS_KEY_ID&#39;</span><span class=p>,</span> <span class=s1>&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span class=p>,</span> <span class=s1>&#39;AWS_END_POINT&#39;</span><span class=p>,</span> <span class=s1>&#39;BUCKET_NAME&#39;</span><span class=o>].</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>key</span><span class=o>|</span>
      <span class=kp>throw</span> <span class=s2>&#34;Set </span><span class=si>#{</span><span class=n>key</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>if</span> <span class=no>ENV</span><span class=o>[</span><span class=n>key</span><span class=o>].</span><span class=n>nil?</span>
    <span class=k>end</span>

    <span class=n>region</span> <span class=o>=</span> <span class=s1>&#39;us-east-1&#39;</span>
    <span class=n>s3_client</span> <span class=o>=</span> <span class=no>Aws</span><span class=o>::</span><span class=no>S3</span><span class=o>::</span><span class=no>Client</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=ss>access_key_id</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s1>&#39;AWS_ACCESS_KEY_ID&#39;</span><span class=o>]</span><span class=p>,</span>
                                    <span class=ss>secret_access_key</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s1>&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span class=o>]</span><span class=p>,</span>
                                    <span class=ss>endpoint</span><span class=p>:</span> <span class=no>ENV</span><span class=o>[</span><span class=s1>&#39;AWS_END_POINT&#39;</span><span class=o>]</span><span class=p>,</span>
                                    <span class=ss>region</span><span class=p>:</span> <span class=n>region</span><span class=p>)</span>
    <span class=n>uploaded</span> <span class=o>=</span> <span class=n>upload_object</span><span class=p>(</span><span class=n>s3_client</span><span class=p>,</span> <span class=no>ENV</span><span class=o>[</span><span class=s1>&#39;BUCKET_NAME&#39;</span><span class=o>]</span><span class=p>,</span> <span class=s1>&#39;upload.rb&#39;</span><span class=p>)</span>
    <span class=nb>puts</span> <span class=s2>&#34;Uploaded = </span><span class=si>#{</span><span class=n>uploaded</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=k>end</span>

  <span class=n>run_me</span> <span class=k>if</span> <span class=vg>$PROGRAM_NAME</span> <span class=o>==</span> <span class=bp>__FILE__</span></code></pre></div></div><h2 id=headline-4>Using curl (failure)</h2><p>This <em>does not work</em> because the signature style isn't apt.</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_ACCESS_KEY_ID</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=p>;</span> <span class=k>then</span>
     <span class=nb>echo</span> Set AWS_ACCESS_KEY_ID
     <span class=nb>exit</span> <span class=m>1</span>
  <span class=k>fi</span>

  <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_SECRET_ACCESS_KEY</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=p>;</span> <span class=k>then</span>
     <span class=nb>echo</span> Set AWS_SECRET_ACCESS_KEY
     <span class=nb>exit</span> <span class=m>1</span>
  <span class=k>fi</span>

  <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_END_POINT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=p>;</span> <span class=k>then</span>
     <span class=nb>echo</span> Set AWS_END_POINT
     <span class=nb>exit</span> <span class=m>1</span>
  <span class=k>fi</span>

  <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BUCKET_NAME</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=p>;</span> <span class=k>then</span>
     <span class=nb>echo</span> Set BUCKET_NAME
     <span class=nb>exit</span> <span class=m>1</span>
  <span class=k>fi</span>

  <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>1</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=p>;</span> <span class=k>then</span>
    <span class=nb>echo</span> Usage <span class=nv>$0</span> filename
    <span class=nb>exit</span> <span class=m>1</span>
  <span class=k>fi</span>

  <span class=nb>echo</span> Good to upload <span class=si>${</span><span class=nv>1</span><span class=si>}</span>

  <span class=c1>#echo $AWS_END_POINT</span>
  <span class=nv>AWS_END_POINT</span><span class=o>=</span>https://gratitude-public.nyc3.digitaloceanspaces.com
  <span class=nv>file</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=si>}</span>
  <span class=nv>bucket</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>BUCKET_NAME</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=nv>contentType</span><span class=o>=</span><span class=s2>&#34;application/octet-stream&#34;</span>
  <span class=nv>dateValue</span><span class=o>=</span><span class=sb>`</span>date -uR<span class=sb>`</span>
  <span class=nv>resource</span><span class=o>=</span><span class=s2>&#34;/</span><span class=si>${</span><span class=nv>bucket</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>file</span><span class=si>}</span><span class=s2>&#34;</span>

  <span class=nv>stringToSign</span><span class=o>=</span><span class=s2>&#34;PUT\n\n</span><span class=si>${</span><span class=nv>contentType</span><span class=si>}</span><span class=s2>\n</span><span class=si>${</span><span class=nv>dateValue</span><span class=si>}</span><span class=s2>\n</span><span class=si>${</span><span class=nv>resource</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=nb>echo</span> <span class=nv>$stringToSign</span>
  <span class=nv>signature</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span> -en <span class=si>${</span><span class=nv>stringToSign</span><span class=si>}</span> <span class=p>|</span> openssl sha1 -hmac <span class=si>${</span><span class=nv>AWS_SECRET_ACCESS_KEY</span><span class=si>}</span> -binary <span class=p>|</span> base64<span class=sb>`</span>

  <span class=nb>echo</span> <span class=nv>$signature</span>
  <span class=nb>echo</span> <span class=nv>$AWS_END_POINT</span>


  curl -X PUT -T <span class=s2>&#34;</span><span class=si>${</span><span class=nv>file</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>       -H <span class=s2>&#34;Host: </span><span class=si>${</span><span class=nv>AWS_END_POINT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>       -H <span class=s2>&#34;Date: </span><span class=si>${</span><span class=nv>dateValue</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>       -H <span class=s2>&#34;Content-Type: </span><span class=si>${</span><span class=nv>contentType</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>       -H <span class=s2>&#34;Authorization: AWS </span><span class=si>${</span><span class=nv>AWS_ACCESS_KEY_ID</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nv>signature</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>       <span class=si>${</span><span class=nv>AWS_END_POINT</span><span class=si>}</span>/<span class=si>${</span><span class=nv>resource</span><span class=si>}</span></code></pre></div></div><h2 id=headline-5>Using curl part two</h2><p>This uses a different signature style which works to digital ocean.</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  <span class=c1>#!/bin/sh -u</span>

  <span class=c1># To the extent possible under law, Viktor Szakats (vsz.me)</span>
  <span class=c1># has waived all copyright and related or neighboring rights to this</span>
  <span class=c1># script.</span>
  <span class=c1># CC0 - https://creativecommons.org/publicdomain/zero/1.0/</span>

  <span class=c1># Upload a file to Amazon AWS S3 using Signature Version 4</span>
  #
  <span class=c1># docs:</span>
  <span class=c1>#   https://docs.aws.amazon.com/general/latest/gr/sigv4-create-canonical-request.html</span>
  #
  <span class=c1># requires:</span>
  <span class=c1>#   curl, openssl 1.x, GNU sed, LF EOLs in this file</span>

  <span class=nv>fileLocal</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=nv>example</span><span class=p>-local-file.ext</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=nv>bucket</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>2</span><span class=k>:-</span><span class=nv>example</span><span class=p>-bucket</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=nv>region</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>3</span><span class=k>:-</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=nv>storageClass</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>4</span><span class=k>:-</span><span class=nv>STANDARD</span><span class=si>}</span><span class=s2>&#34;</span>  <span class=c1># or &#39;REDUCED_REDUNDANCY&#39;</span>

  my_openssl<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>[</span> -f /usr/local/opt/openssl@1.1/bin/openssl <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
      /usr/local/opt/openssl@1.1/bin/openssl <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
    <span class=k>elif</span> <span class=o>[</span> -f /usr/local/opt/openssl/bin/openssl <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
      /usr/local/opt/openssl/bin/openssl <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
    <span class=k>else</span>
      openssl <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
    <span class=k>fi</span>
  <span class=o>}</span>

  my_sed<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> which gsed &gt; /dev/null 2&gt;<span class=p>&amp;</span>1<span class=p>;</span> <span class=k>then</span>
      gsed <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
    <span class=k>else</span>
      sed <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
    <span class=k>fi</span>
  <span class=o>}</span>

  awsStringSign4<span class=o>()</span> <span class=o>{</span>
    <span class=nv>kSecret</span><span class=o>=</span><span class=s2>&#34;AWS4</span><span class=nv>$1</span><span class=s2>&#34;</span>
    <span class=nv>kDate</span><span class=o>=</span><span class=k>$(</span><span class=nb>printf</span>         <span class=s1>&#39;%s&#39;</span> <span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span> <span class=p>|</span> my_openssl dgst -sha256 -hex -mac HMAC -macopt <span class=s2>&#34;key:</span><span class=si>${</span><span class=nv>kSecret</span><span class=si>}</span><span class=s2>&#34;</span>     2&gt;/dev/null <span class=p>|</span> my_sed <span class=s1>&#39;s/^.* //&#39;</span><span class=k>)</span>
    <span class=nv>kRegion</span><span class=o>=</span><span class=k>$(</span><span class=nb>printf</span>       <span class=s1>&#39;%s&#39;</span> <span class=s2>&#34;</span><span class=nv>$3</span><span class=s2>&#34;</span> <span class=p>|</span> my_openssl dgst -sha256 -hex -mac HMAC -macopt <span class=s2>&#34;hexkey:</span><span class=si>${</span><span class=nv>kDate</span><span class=si>}</span><span class=s2>&#34;</span>    2&gt;/dev/null <span class=p>|</span> my_sed <span class=s1>&#39;s/^.* //&#39;</span><span class=k>)</span>
    <span class=nv>kService</span><span class=o>=</span><span class=k>$(</span><span class=nb>printf</span>      <span class=s1>&#39;%s&#39;</span> <span class=s2>&#34;</span><span class=nv>$4</span><span class=s2>&#34;</span> <span class=p>|</span> my_openssl dgst -sha256 -hex -mac HMAC -macopt <span class=s2>&#34;hexkey:</span><span class=si>${</span><span class=nv>kRegion</span><span class=si>}</span><span class=s2>&#34;</span>  2&gt;/dev/null <span class=p>|</span> my_sed <span class=s1>&#39;s/^.* //&#39;</span><span class=k>)</span>
    <span class=nv>kSigning</span><span class=o>=</span><span class=k>$(</span><span class=nb>printf</span> <span class=s1>&#39;aws4_request&#39;</span> <span class=p>|</span> my_openssl dgst -sha256 -hex -mac HMAC -macopt <span class=s2>&#34;hexkey:</span><span class=si>${</span><span class=nv>kService</span><span class=si>}</span><span class=s2>&#34;</span> 2&gt;/dev/null <span class=p>|</span> my_sed <span class=s1>&#39;s/^.* //&#39;</span><span class=k>)</span>
    <span class=nv>signedString</span><span class=o>=</span><span class=k>$(</span><span class=nb>printf</span>  <span class=s1>&#39;%s&#39;</span> <span class=s2>&#34;</span><span class=nv>$5</span><span class=s2>&#34;</span> <span class=p>|</span> my_openssl dgst -sha256 -hex -mac HMAC -macopt <span class=s2>&#34;hexkey:</span><span class=si>${</span><span class=nv>kSigning</span><span class=si>}</span><span class=s2>&#34;</span> 2&gt;/dev/null <span class=p>|</span> my_sed <span class=s1>&#39;s/^.* //&#39;</span><span class=k>)</span>
    <span class=nb>printf</span> <span class=s1>&#39;%s&#39;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>signedString</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=o>}</span>

  iniGet<span class=o>()</span> <span class=o>{</span>
    <span class=c1># based on: https://stackoverflow.com/questions/22550265/read-certain-key-from-certain-section-of-ini-file-sed-awk#comment34321563_22550640</span>
    <span class=nb>printf</span> <span class=s1>&#39;%s&#39;</span> <span class=s2>&#34;</span><span class=k>$(</span>my_sed -n -E <span class=s2>&#34;/\[</span><span class=nv>$2</span><span class=s2>\]/,/\[.*\]/{/</span><span class=nv>$3</span><span class=s2>/s/(.*)=[ \\t]*(.*)/\2/p}&#34;</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
  <span class=o>}</span>

  <span class=c1># Initialize access keys</span>

  <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_CONFIG_FILE</span><span class=k>:-</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_ACCESS_KEY_ID</span><span class=k>:-</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
      <span class=nb>echo</span> <span class=s1>&#39;AWS_CONFIG_FILE or AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY envvars not set.&#39;</span>
      <span class=nb>exit</span> <span class=m>1</span>
    <span class=k>else</span>
      <span class=nv>awsAccess</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_ACCESS_KEY_ID</span><span class=si>}</span><span class=s2>&#34;</span>
      <span class=nv>awsSecret</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_SECRET_ACCESS_KEY</span><span class=si>}</span><span class=s2>&#34;</span>
      <span class=nv>awsRegion</span><span class=o>=</span><span class=s1>&#39;us-east-1&#39;</span>
    <span class=k>fi</span>
  <span class=k>else</span>
    <span class=nv>awsProfile</span><span class=o>=</span><span class=s1>&#39;default&#39;</span>

    <span class=c1># Read standard aws-cli configuration file</span>
    <span class=c1># pointed to by the envvar AWS_CONFIG_FILE</span>
    <span class=nv>awsAccess</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>iniGet <span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_CONFIG_FILE</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>awsProfile</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s1>&#39;aws_access_key_id&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
    <span class=nv>awsSecret</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>iniGet <span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_CONFIG_FILE</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>awsProfile</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s1>&#39;aws_secret_access_key&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
    <span class=nv>awsRegion</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>iniGet <span class=s2>&#34;</span><span class=si>${</span><span class=nv>AWS_CONFIG_FILE</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>awsProfile</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s1>&#39;region&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
  <span class=k>fi</span>

  <span class=c1># Initialize defaults</span>

  <span class=nv>fileRemote</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>fileLocal</span><span class=si>}</span><span class=s2>&#34;</span>

  <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>region</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    <span class=nv>region</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>awsRegion</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=k>fi</span>

  <span class=nb>echo</span> <span class=s2>&#34;Uploading&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>fileLocal</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;-&gt;&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>bucket</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>region</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>storageClass</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=nb>echo</span> <span class=s2>&#34;| </span><span class=k>$(</span>uname<span class=k>)</span><span class=s2> | </span><span class=k>$(</span>my_openssl version<span class=k>)</span><span class=s2> | </span><span class=k>$(</span>my_sed --version <span class=p>|</span> head -1<span class=k>)</span><span class=s2> |&#34;</span>

  <span class=c1># Initialize helper variables</span>

  <span class=nv>httpReq</span><span class=o>=</span><span class=s1>&#39;PUT&#39;</span>
  <span class=nv>authType</span><span class=o>=</span><span class=s1>&#39;AWS4-HMAC-SHA256&#39;</span>
  <span class=nv>service</span><span class=o>=</span><span class=s1>&#39;s3&#39;</span>
  <span class=nv>baseUrl</span><span class=o>=</span><span class=s2>&#34;.</span><span class=si>${</span><span class=nv>service</span><span class=si>}</span><span class=s2>.amazonaws.com&#34;</span>
  <span class=nv>baseUrl</span><span class=o>=</span><span class=s2>&#34;.nyc3.digitaloceanspaces.com&#34;</span>
  <span class=nv>dateValueS</span><span class=o>=</span><span class=k>$(</span>date -u +<span class=s1>&#39;%Y%m%d&#39;</span><span class=k>)</span>
  <span class=nv>dateValueL</span><span class=o>=</span><span class=k>$(</span>date -u +<span class=s1>&#39;%Y%m%dT%H%M%SZ&#39;</span><span class=k>)</span>
  <span class=k>if</span> <span class=nb>hash</span> file 2&gt;/dev/null<span class=p>;</span> <span class=k>then</span>
    <span class=nv>contentType</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>file --brief --mime-type <span class=s2>&#34;</span><span class=si>${</span><span class=nv>fileLocal</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
  <span class=k>else</span>
    <span class=nv>contentType</span><span class=o>=</span><span class=s1>&#39;application/octet-stream&#39;</span>
  <span class=k>fi</span>

  <span class=c1># 0. Hash the file to be uploaded</span>

  <span class=k>if</span> <span class=o>[</span> -f <span class=s2>&#34;</span><span class=si>${</span><span class=nv>fileLocal</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    <span class=nv>payloadHash</span><span class=o>=</span><span class=k>$(</span>my_openssl dgst -sha256 -hex &lt; <span class=s2>&#34;</span><span class=si>${</span><span class=nv>fileLocal</span><span class=si>}</span><span class=s2>&#34;</span> 2&gt;/dev/null <span class=p>|</span> my_sed <span class=s1>&#39;s/^.* //&#39;</span><span class=k>)</span>
  <span class=k>else</span>
    <span class=nb>echo</span> <span class=s2>&#34;File not found: &#39;</span><span class=si>${</span><span class=nv>fileLocal</span><span class=si>}</span><span class=s2>&#39;&#34;</span>
    <span class=nb>exit</span> <span class=m>1</span>
  <span class=k>fi</span>

  <span class=c1># 1. Create canonical request</span>

  <span class=c1># NOTE: order significant in ${headerList} and ${canonicalRequest}</span>

  <span class=nv>headerList</span><span class=o>=</span><span class=s1>&#39;content-type;host;x-amz-content-sha256;x-amz-date;x-amz-server-side-encryption;x-amz-storage-class&#39;</span>

  <span class=nv>canonicalRequest</span><span class=o>=</span><span class=s2>&#34;\
</span><span class=s2>  </span><span class=si>${</span><span class=nv>httpReq</span><span class=si>}</span><span class=s2>
</span><span class=s2>  /</span><span class=si>${</span><span class=nv>fileRemote</span><span class=si>}</span><span class=s2>
</span><span class=s2>
</span><span class=s2>  content-type:</span><span class=si>${</span><span class=nv>contentType</span><span class=si>}</span><span class=s2>
</span><span class=s2>  host:</span><span class=si>${</span><span class=nv>bucket</span><span class=si>}${</span><span class=nv>baseUrl</span><span class=si>}</span><span class=s2>
</span><span class=s2>  x-amz-content-sha256:</span><span class=si>${</span><span class=nv>payloadHash</span><span class=si>}</span><span class=s2>
</span><span class=s2>  x-amz-date:</span><span class=si>${</span><span class=nv>dateValueL</span><span class=si>}</span><span class=s2>
</span><span class=s2>  x-amz-server-side-encryption:AES256
</span><span class=s2>  x-amz-storage-class:</span><span class=si>${</span><span class=nv>storageClass</span><span class=si>}</span><span class=s2>
</span><span class=s2>
</span><span class=s2>  </span><span class=si>${</span><span class=nv>headerList</span><span class=si>}</span><span class=s2>
</span><span class=s2>  </span><span class=si>${</span><span class=nv>payloadHash</span><span class=si>}</span><span class=s2>&#34;</span>

  <span class=c1># Hash it</span>

  <span class=nv>canonicalRequestHash</span><span class=o>=</span><span class=k>$(</span><span class=nb>printf</span> <span class=s1>&#39;%s&#39;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>canonicalRequest</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>|</span> my_openssl dgst -sha256 -hex 2&gt;/dev/null <span class=p>|</span> my_sed <span class=s1>&#39;s/^.* //&#39;</span><span class=k>)</span>

  <span class=c1># 2. Create string to sign</span>

  <span class=nv>stringToSign</span><span class=o>=</span><span class=s2>&#34;\
</span><span class=s2>  </span><span class=si>${</span><span class=nv>authType</span><span class=si>}</span><span class=s2>
</span><span class=s2>  </span><span class=si>${</span><span class=nv>dateValueL</span><span class=si>}</span><span class=s2>
</span><span class=s2>  </span><span class=si>${</span><span class=nv>dateValueS</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>region</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>service</span><span class=si>}</span><span class=s2>/aws4_request
</span><span class=s2>  </span><span class=si>${</span><span class=nv>canonicalRequestHash</span><span class=si>}</span><span class=s2>&#34;</span>

  <span class=c1># 3. Sign the string</span>

  <span class=nv>signature</span><span class=o>=</span><span class=k>$(</span>awsStringSign4 <span class=s2>&#34;</span><span class=si>${</span><span class=nv>awsSecret</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>dateValueS</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>region</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>service</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>stringToSign</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span>

  <span class=c1># Upload</span>

  curl --location --proto-redir <span class=o>=</span>https --request <span class=s2>&#34;</span><span class=si>${</span><span class=nv>httpReq</span><span class=si>}</span><span class=s2>&#34;</span> --upload-file <span class=s2>&#34;</span><span class=si>${</span><span class=nv>fileLocal</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>    --header <span class=s2>&#34;Content-Type: </span><span class=si>${</span><span class=nv>contentType</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>    --header <span class=s2>&#34;Host: </span><span class=si>${</span><span class=nv>bucket</span><span class=si>}${</span><span class=nv>baseUrl</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>    --header <span class=s2>&#34;X-Amz-Content-SHA256: </span><span class=si>${</span><span class=nv>payloadHash</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>    --header <span class=s2>&#34;X-Amz-Date: </span><span class=si>${</span><span class=nv>dateValueL</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>    --header <span class=s2>&#34;X-Amz-Server-Side-Encryption: AES256&#34;</span> <span class=se>\
</span><span class=se></span>    --header <span class=s2>&#34;X-Amz-Storage-Class: </span><span class=si>${</span><span class=nv>storageClass</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>    --header <span class=s2>&#34;Authorization: </span><span class=si>${</span><span class=nv>authType</span><span class=si>}</span><span class=s2> Credential=</span><span class=si>${</span><span class=nv>awsAccess</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>dateValueS</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>region</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>service</span><span class=si>}</span><span class=s2>/aws4_request, SignedHeaders=</span><span class=si>${</span><span class=nv>headerList</span><span class=si>}</span><span class=s2>, Signature=</span><span class=si>${</span><span class=nv>signature</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>    <span class=s2>&#34;https://</span><span class=si>${</span><span class=nv>bucket</span><span class=si>}${</span><span class=nv>baseUrl</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>fileRemote</span><span class=si>}</span><span class=s2>&#34;</span></code></pre></div></div><h2 id=headline-6>Debian aws cli tools</h2><div class="src src-dockerfile"><div class=highlight><pre class=chroma><code class=language-dockerfile data-lang=dockerfile>  FROM debian:11<span class=err>
</span><span class=err></span>  RUN apt update <span class=o>&amp;&amp;</span> apt install -y unzip curl<span class=err>
</span><span class=err></span>  RUN curl <span class=s2>&#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&#34;</span> -o <span class=s2>&#34;awscliv2.zip&#34;</span> <span class=o>&amp;&amp;</span> unzip awscliv2.zip <span class=o>&amp;&amp;</span> ./aws/install <span class=err>
</span><span class=err>
</span><span class=err></span>      <span class=c1>#RUN apt install -y wget gnupg</span><span class=err>
</span><span class=err></span>      <span class=c1>#RUN wget -O- -q http://s3tools.org/repo/deb-all/stable/s3tools.key | apt-key add -</span><span class=err>
</span><span class=err></span>    <span class=c1>#RUN wget -O /etc/apt/sources.list.d/s3tools.list http://s3tools.org/repo/deb-all/stable/s3tools.list</span><span class=err>
</span><span class=err></span>    <span class=c1>#RUN apt update &amp;&amp; apt install s3cmd</span><span class=err>
</span><span class=err></span>  CMD bash</code></pre></div></div><p>Then build with</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker build . -f Dockerfile.awscli -t awscli</code></pre></div></div><p>Now run it, passing in the right environment variables:</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  docker run --rm -it <span class=se>\
</span><span class=se></span>         -e AWS_ACCESS_KEY_ID <span class=se>\
</span><span class=se></span>         -e AWS_SECRET_ACCESS_KEY <span class=se>\
</span><span class=se></span>         -e AWS_END_POINT <span class=se>\
</span><span class=se></span>         -e BUCKET_NAME <span class=se>\
</span><span class=se></span>         awscli</code></pre></div></div><p>Then to list the buckets:</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>aws s3 ls --endpoint<span class=o>=</span><span class=si>${</span><span class=nv>AWS_END_POINT</span><span class=si>}</span></code></pre></div></div><p>And to copy a file over:</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>aws s3 cp testfile s3://<span class=si>${</span><span class=nv>BUCKET_NAME</span><span class=si>}</span>/testfile --acl public-read --endpoint<span class=o>=</span><span class=si>${</span><span class=nv>AWS_END_POINT</span><span class=si>}</span></code></pre></div></div><h2 id=headline-7>s3cmd</h2><div class="src src-dockerfile"><div class=highlight><pre class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=k>FROM</span><span class=s> debian:11</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> apt update<span class=err>
</span><span class=err></span><span class=k>RUN</span> apt install -y curl unzip python python-setuptools <span class=c1># python-dateutil python-setuptools</span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /tmp</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> curl -LJO https://github.com/s3tools/s3cmd/releases/download/v2.1.0/s3cmd-2.1.0.zip <span class=o>&amp;&amp;</span> <span class=se>\
</span><span class=se></span>    unzip s3cmd-2.1.0.zip <span class=o>&amp;&amp;</span> rm s3cmd-2.1.0.zip <span class=o>&amp;&amp;</span> <span class=nb>cd</span> s3cmd-2.1.0 <span class=o>&amp;&amp;</span> <span class=se>\
</span><span class=se></span>    python setup.py install <span class=o>&amp;&amp;</span> rm -rf /tmp/s3cmd-2.1.0<span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span><span class=err></span><span class=k>CMD</span> bash</code></pre></div></div><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker build . -f Dockerfile.s3cmd -t s3cmd</code></pre></div></div><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  docker run --rm -it <span class=se>\
</span><span class=se></span>         -e AWS_ACCESS_KEY_ID <span class=se>\
</span><span class=se></span>         -e AWS_SECRET_ACCESS_KEY <span class=se>\
</span><span class=se></span>         -e AWS_END_POINT <span class=se>\
</span><span class=se></span>         -e BUCKET_NAME <span class=se>\
</span><span class=se></span>         s3cmd</code></pre></div></div><p>Then to copy over a file</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  s3cmd put testfile2 s3://<span class=si>${</span><span class=nv>BUCKET_NAME</span><span class=si>}</span> --acl-public <span class=se>\
</span><span class=se></span>        --host<span class=o>=</span>nyc3.digitaloceanspaces.com <span class=se>\
</span><span class=se></span>        --host-bucket<span class=o>=</span><span class=si>${</span><span class=nv>BUCKET</span><span class=si>}</span>s.nyc3.digitaloceanspaces.com</code></pre></div></div><p><code class=verbatim>s3cmd</code> has a lot more functionality other than copying, so if you are
looking for something more complex – like mirroring – it is worth
exploring.</p><h2 id=headline-8>References</h2><ol><li><p><a href=https://superuser.com/questions/279986/uploading-files-to-s3-account-from-linux-command-line>https://superuser.com/questions/279986/uploading-files-to-s3-account-from-linux-command-line</a></p></li><li><p><a href=https://gist.github.com/chrismdp/6c6b6c825b07f680e710>https://gist.github.com/chrismdp/6c6b6c825b07f680e710</a></p></li><li><p><a href=https://tmont.com/blargh/2014/1/uploading-to-s3-in-bash>https://tmont.com/blargh/2014/1/uploading-to-s3-in-bash</a></p></li><li><p><a href=https://s3tools.org/s3cmd>https://s3tools.org/s3cmd</a></p></li><li><p><a href=https://github.com/s3tools/s3cmd/issues/1018>https://github.com/s3tools/s3cmd/issues/1018</a></p></li><li><p><a href=https://docs.digitalocean.com/products/spaces/resources/s3cmd/>https://docs.digitalocean.com/products/spaces/resources/s3cmd/</a></p></li><li><p><a href=https://gist.github.com/vszakats/2917d28a951844ab80b1>https://gist.github.com/vszakats/2917d28a951844ab80b1</a></p></li></ol></article></div><div class="bg-light py-5"><div class=container><h2 class=text-center>Read next</h2><div class=row><div class="col-md-6 text-center"></div><div class="col-md-6 text-center">Previous Post:
<a href=../../../articles/2021/rails_on_kubernetes_with_tls/>Rails on Kubernetes with TLS</a></div></div></div></div><div class="container mt-5"><h2 class=text-center>See also</h2><div class=row><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2020/looking_at_gemfiles/>Looking at Gemfiles</a></p><p class="lead font-italic mb-0">making sense of Gemfile.lock</p><div class="font-weight-light mt-3"><p>Bundler is the standard way for Ruby projects to specifiy dependencies. Let's take a look at how that works, reimplement bundle outdated, and be able to see the changes that took place between the build you are using and the latest one. Ruby ecosystem: Rubygems, Bundler, Gemfile, Gemfile.lock rubygems is the overall ecosystem, which includes the main rubygems.org database of shared packages, and how they depend upon each other.</p></div><a href=../../../articles/2020/looking_at_gemfiles/ class="btn btn-primary">Read more</a></div><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2020/checking_rss_health/>Checking health of RSS feeds</a></p><p class="lead font-italic mb-0">Lets clean out the old stuff</p><div class="font-weight-light mt-3"><p>I still use RSS feeds as my main way of consuming stuff on the internet. Old school. I was looking at the list of things that I've subscribed to which has been imported back from the Google Reader days, and figured I'd do some exploration of ye old OPML file. Setup the Gemfile We'll need to pull in a few gems here: source 'https://rubygems.org' gem 'httparty' # To pull stuff from the network gem 'feedjira' # To parse RSS feeds gem 'nokogiri' # To parse XML gem 'domainator' # To figured out the domain from the hostname gem 'whois' # To see how old the domain is gem 'whois-parser' # To actually make sense of the result And install everything bundle Look at domains First, lets see what we can find out about the machine that hosts the feed.</p></div><a href=../../../articles/2020/checking_rss_health/ class="btn btn-primary">Read more</a></div></div></div><footer class="footer bg-dark text-light mt-3"><div class=container><h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2></div></footer></body></html>