<!doctype html><html><head><title>NextJS with Prisma on Kubernetes</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=../../../css/theme.css><link rel=stylesheet href=../../../css/syntax.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-56296045-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script async defer data-domain=willschenk.com src=https://plausible.io/js/plausible.js></script><meta property="og:title" content="NextJS with Prisma on Kubernetes"><meta property="og:description" content="Now that we have our cluster up and running, lets look at how to build and deploy a NextJS app on it, including the database. Create a NextJS app   We'll scaffold out a TypeScript app. npx create-next-app@latest --typescript myapp cd myapp npm run dev  Fireup a local data  docker run -e POSTGRES_PASSWORD=awesome_password -p 5432:5432 postgres  Install prisma   We'll add the npm packages to our project."><meta property="og:type" content="article"><meta property="og:url" content="https://willschenk.com/articles/2021/next_js_with_prisma/"><meta property="article:published_time" content="2021-12-08T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-08T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="NextJS with Prisma on Kubernetes"><meta name=twitter:description content="Now that we have our cluster up and running, lets look at how to build and deploy a NextJS app on it, including the database. Create a NextJS app   We'll scaffold out a TypeScript app. npx create-next-app@latest --typescript myapp cd myapp npm run dev  Fireup a local data  docker run -e POSTGRES_PASSWORD=awesome_password -p 5432:5432 postgres  Install prisma   We'll add the npm packages to our project."><meta name=twitter:site content="@wschenk"><style>.article p,.article ul,.article ol,.article table{max-width:45em}.article pre p{max-width:none;margin-top:-1.5rem}article.article p:first-child,.article blockquote{font-size:1.25em;font-weight:300;max-width:36em}.half-height-scroll{max-height:32em;overflow:scroll}</style></head><body><nav class="container my-5"><h1 class="pt-md-5 display-3"><a class=text-dark href=../../../>Will Schenk</a></h1><p><a class="text-dark h4 mr-3 font-weight-light" href=../../../articles/>Articles</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../contact>Contact</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../tags/>Tags</a>
<a href=../../../feed.xml class="mr-3 h4 text-light"><img src=../../../img/rss.svg alt=rss height=20 width=20></a>
<a href=https://twitter.com/@wschenk class="mr-3 h4 text-light"><img src=../../../img/twitter.svg alt=twitter height=20 width=20></a>
<a href=https://instagram.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/instagram.svg alt=instagram height=20 width=20></a>
<a href=https://github.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/github.svg alt=github height=20 width=20></a>
<a href=https://linkedin.com/in/will-schenk-420266 class="mr-3 h4 text-light"><img src=../../../img/linkedin.svg alt=linkedin height=20 width=20></a></p></nav><div class=container><h1 class=mt-5>NextJS with Prisma on Kubernetes</h1><h2 class="font-weight-light font-italic mb-3">deploy as a knative service</h2><p class="text-muted mt-3"><a class=text-muted href=https://willschenk.com/articles/2021/next_js_with_prisma/>Published December 8, 2021</a>
<a class=text-muted href=../../../tags/nextjs>#nextjs,</a>
<a class=text-muted href=../../../tags/javascript>#javascript,</a>
<a class=text-muted href=../../../tags/prisma>#prisma,</a>
<a class=text-muted href=../../../tags/knative>#knative,</a>
<a class=text-muted href=../../../tags/kubernetes>#kubernetes</a></p><article class="article mt-5"><p>Now that we have our cluster up and running, lets look at how to build
and deploy a <a href=https://nextjs.org/>NextJS</a> app on it, including the database.</p><h2 id=headline-1>Create a NextJS app</h2><p>We'll scaffold out a TypeScript app.</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npx create-next-app@latest --typescript  myapp 

  <span class=nb>cd</span> myapp

  npm run dev</code></pre></div></div><h2 id=headline-2>Fireup a local data</h2><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  docker run -e <span class=nv>POSTGRES_PASSWORD</span><span class=o>=</span>awesome_password -p 5432:5432 postgres</code></pre></div></div><h2 id=headline-3>Install <code class=verbatim>prisma</code></h2><p>We'll add the npm packages to our project.</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npm install prisma

  npx prisma init</code></pre></div></div><p>Edit <code class=verbatim>.env</code> and change the url to be</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  <span class=nv>DATABASE_URL</span><span class=o>=</span><span class=s2>&#34;postgresql://postgres:awesome_password@localhost:5432/mydb?schema=public&#34;</span></code></pre></div></div><h3 id=headline-4>Data Models</h3><p>In <code class=verbatim>primsa/schema.prisma</code> add a model:</p><div class="src src-text"><div class=highlight><pre class=chroma><code class=language-text data-lang=text>model Post {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  title     String   @db.VarChar(255)
  content   String?
}</code></pre></div></div><h3 id=headline-5>Run the migration</h3><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npx prisma migrate dev --name init</code></pre></div></div><h3 id=headline-6>Run <code class=verbatim>prisma studio</code> to check it out</h3><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npx prisma studio</code></pre></div></div><h2 id=headline-7>Write the post page and api</h2><p>This is a basic demostration, so nothing fancy.</p><h3 id=headline-8><code class=verbatim>tsconfig.json</code></h3><p>Add</p><p><code class=verbatim>"baseUrl" : "."</code> and <code class=verbatim>"strict":"false"</code> to <code class=verbatim>compilerOptions</code>.</p><h3 id=headline-9><code class=verbatim>lib/prisma.ts</code></h3><div class="src src-typescript"><div class=highlight><pre class=chroma><code class=language-typescript data-lang=typescript>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>PrismaClient</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@prisma/client&#39;</span><span class=p>;</span>

  <span class=kr>declare</span> <span class=nx>global</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=nx>prisma</span>: <span class=kt>PrismaClient</span> <span class=o>|</span> <span class=kc>undefined</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=kr>export</span> <span class=kr>const</span> <span class=nx>prisma</span> <span class=o>=</span> <span class=nx>global</span><span class=p>.</span><span class=nx>prisma</span> <span class=o>||</span> <span class=k>new</span> <span class=nx>PrismaClient</span><span class=p>();</span>

  <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>!==</span> <span class=s1>&#39;production&#39;</span><span class=p>)</span> <span class=nx>global</span><span class=p>.</span><span class=nx>prisma</span> <span class=o>=</span> <span class=nx>prisma</span><span class=p>;</span>
</code></pre></div></div><h3 id=headline-10><code class=verbatim>pages/posts.ts</code></h3><p>We'll use <code class=verbatim>react-hook-form</code> to make things simplier.</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npm install react-hook-form</code></pre></div></div><p>A couple points.</p><ol><li><p>We query the database in <code class=verbatim>getServiceSideProps</code></p></li><li><p>We are fetching our API from <code class=verbatim>window.location.origin</code></p></li><li><p>We are totally hacking the window reload, I'm just lazy</p></li></ol><div class="src src-typescript"><div class=highlight><pre class=chroma><code class=language-typescript data-lang=typescript>  <span class=kr>import</span> <span class=nx>Head</span> <span class=nx>from</span> <span class=s1>&#39;next/head&#39;</span><span class=p>;</span>
  <span class=kr>import</span> <span class=p>{</span> <span class=nx>prisma</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;lib/prisma&#39;</span><span class=p>;</span>
  <span class=kr>import</span> <span class=p>{</span> <span class=nx>Post</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;.prisma/client&#39;</span><span class=p>;</span>
  <span class=kr>import</span> <span class=nx>Link</span> <span class=nx>from</span> <span class=s1>&#39;next/link&#39;</span><span class=p>;</span>
  <span class=kr>import</span> <span class=p>{</span> <span class=nx>useForm</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-hook-form&#39;</span><span class=p>;</span>

  <span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>PostsPage</span><span class=p>({</span> <span class=nx>posts</span> <span class=p>})</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=p>{</span>
      <span class=nx>register</span><span class=p>,</span>
      <span class=nx>handleSubmit</span><span class=p>,</span>
      <span class=nx>formState</span><span class=o>:</span> <span class=p>{</span> <span class=nx>errors</span><span class=p>,</span> <span class=nx>isSubmitted</span> <span class=p>},</span>
    <span class=p>}</span> <span class=o>=</span> <span class=nx>useForm</span><span class=p>();</span>

    <span class=kr>const</span> <span class=nx>onSubmit</span> <span class=o>=</span> <span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
      <span class=k>try</span> <span class=p>{</span>
        <span class=nx>fetch</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>origin</span><span class=si>}</span><span class=sb>/api/create`</span><span class=p>,</span> <span class=p>{</span>
          <span class=nx>body</span>: <span class=kt>JSON.stringify</span><span class=p>(</span><span class=nx>data</span><span class=p>),</span>
          <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
            <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
          <span class=p>},</span>
          <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
        <span class=p>}).</span><span class=nx>then</span><span class=p>(</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
          <span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>href</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>href</span>
         <span class=p>}</span> <span class=p>)</span>
      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
      <span class=p>}</span>
    <span class=p>};</span>

      <span class=k>return</span> <span class=p>(</span>
        <span class=o>&lt;&gt;</span>
          <span class=o>&lt;</span><span class=nx>ul</span><span class=o>&gt;</span>
              <span class=p>{</span><span class=nx>posts</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span>: <span class=kt>Post</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
                  <span class=o>&lt;</span><span class=nx>li</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>content</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/li&gt;</span>
              <span class=p>))}</span>
          <span class=o>&lt;</span><span class=err>/ul&gt;</span>
          <span class=o>&lt;</span><span class=nx>form</span> <span class=nx>onSubmit</span><span class=o>=</span><span class=p>{</span><span class=nx>handleSubmit</span><span class=p>(</span><span class=nx>onSubmit</span><span class=p>)}</span><span class=o>&gt;</span>
            <span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span><span class=nx>Title</span><span class=o>&lt;</span><span class=err>/label&gt;</span>
            <span class=o>&lt;</span><span class=nx>input</span> 
              <span class=nx>id</span><span class=o>=</span><span class=s2>&#34;title&#34;</span>
              <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;text&#34;</span> 
              <span class=p>{...</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=p>{</span><span class=nx>required</span>: <span class=kt>true</span><span class=p>})}</span><span class=o>/&gt;</span>
              <span class=o>&lt;</span><span class=nx>br</span><span class=o>/&gt;</span>
            <span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span><span class=nx>Content</span><span class=o>&lt;</span><span class=err>/label&gt;</span>
            <span class=o>&lt;</span><span class=nx>input</span> 
              <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;text&#34;</span> 
              <span class=nx>id</span><span class=o>=</span><span class=s2>&#34;content&#34;</span>
              <span class=p>{...</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;content&#39;</span><span class=p>,</span> <span class=p>{</span><span class=nx>required</span>: <span class=kt>true</span><span class=p>})}</span><span class=o>/&gt;</span>
            <span class=o>&lt;</span><span class=nx>input</span> <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;submit&#34;</span><span class=o>/&gt;</span>
          <span class=o>&lt;</span><span class=err>/form&gt;</span>
          <span class=o>&lt;</span><span class=err>/&gt;</span>
      <span class=p>);</span>
  <span class=p>}</span>

  <span class=kr>export</span> <span class=kr>const</span> <span class=nx>getServerSideProps</span> <span class=o>=</span> <span class=nx>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>posts</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>prisma</span><span class=p>.</span><span class=nx>post</span><span class=p>.</span><span class=nx>findMany</span><span class=p>({</span>
      <span class=nx>select</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>id</span>: <span class=kt>true</span><span class=p>,</span>
        <span class=nx>title</span>: <span class=kt>true</span><span class=p>,</span>
        <span class=nx>content</span>: <span class=kt>true</span>
      <span class=p>},</span>
    <span class=p>});</span>

    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>posts</span><span class=p>);</span>
    <span class=k>return</span> <span class=p>{</span>
      <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>posts</span><span class=p>,</span>
      <span class=p>},</span>
    <span class=p>};</span>
  <span class=p>};</span>
</code></pre></div></div><h3 id=headline-11><code class=verbatim>api/create.ts</code></h3><p>This is the api request to handle the post. It runs on the server.</p><div class="src src-typescript"><div class=highlight><pre class=chroma><code class=language-typescript data-lang=typescript><span class=kr>import</span> <span class=p>{</span> <span class=nx>prisma</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;lib/prisma&#39;</span><span class=p>;</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>async</span> <span class=kd>function</span> <span class=nx>handler</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
  <span class=kr>const</span> <span class=p>{</span> <span class=nx>content</span><span class=p>,</span> <span class=nx>title</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>

  <span class=k>try</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>feedback</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>prisma</span><span class=p>.</span><span class=nx>post</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>content</span><span class=p>,</span>
        <span class=nx>title</span><span class=p>,</span>
      <span class=p>},</span>
    <span class=p>});</span>
    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>feedback</span><span class=p>);</span>
  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span>
      <span class=nx>message</span><span class=o>:</span> <span class=sb>`Something went wrong :/ </span><span class=si>${</span><span class=nx>error</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
    <span class=p>});</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><h2 id=headline-12>Setup <code class=verbatim>postgres</code> on your cluster</h2><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  helm repo add bitnami https://charts.bitnami.com/bitnami
  helm upgrade --install postgres bitnami/postgresql</code></pre></div></div><p>Eventually the database will be available on <code class=verbatim>postgres-postgresql.default.svc.cluster.local</code></p><p>We can get the password using</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  kubectl get secret --namespace default postgres-postgresql -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&#34;{.data.postgresql-password}&#34;</span> <span class=p>|</span> base64 --decode</code></pre></div></div><p>When we deploy the function we'll set the <code class=verbatim>DATABASE_URL</code> to look something like:</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  <span class=nv>DATABASE_URL</span><span class=o>=</span><span class=s2>&#34;postgresql://postgres:1oOFIcOvB1@postgres-postgresql.default.svc.cluster.local:5432/database?schema=public&#34;</span></code></pre></div></div><p>You'll need to update that with your actual password of course.</p><h3 id=headline-13>Migrate the database</h3><p>We are going to setup the database from our local enviornment. We'll
use <code class=verbatim>kubectl</code> to forward the local postgres port to the remote install.
<em>Remember to stop your local postgres container</em></p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  kubectl port-forward svc/postgres-postgresql 5432:5432</code></pre></div></div><p>Then, using the password that we found above, deploy the current
migrations to the postgres that's being forwared on localhost. This
is a different url then the previous one shown!:</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  <span class=nv>DATABASE_URL</span><span class=o>=</span><span class=s2>&#34;postgresql://postgres:1oOFIcOvB1@localhost:5432/database?schema=public&#34;</span> <span class=se>\
</span><span class=se></span>              npx prisma migrate deploy</code></pre></div></div><p>You can also run <code class=verbatim>prisma studio</code> that way, by the way.</p><h2 id=headline-14>Deploy the service</h2><h3 id=headline-15>Build image</h3><p>We need to tweaks the dockerfile <a href=https://nextjs.org/docs/deployment>from the official docs</a> to add <code class=verbatim>prisma
generate</code> to get the client code. So, copy over that <code class=verbatim>Dockerfile</code> and
then, right after it copies the <code class=verbatim>node_modules</code> over added</p><p><code class=verbatim>RUN npx prisma generate</code></p><p>For me it's on like 14, right before <code class=verbatim>yarn build</code>.</p><p>Since I'm working off an M1 mac, I need to set the <code class=verbatim>--platform</code> to make
sure that the image is built using the correct binaries. An example
of this is:</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  docker build . --platform linux/amd64 -t wschenk/prismatest <span class=o>&amp;&amp;</span> docker push wschenk/prismatest</code></pre></div></div><h3 id=headline-16>Create the service</h3><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>    kn service create prisma <span class=se>\
</span><span class=se></span>       --image wschenk/prismatest <span class=se>\
</span><span class=se></span>       --env <span class=nv>DATABASE_URL</span><span class=o>=</span><span class=s2>&#34;postgresql://postgres:1oOFIcOvB1@postgres-postgresql.default.svc.cluster.local:5432/database?schema=public&#34;</span></code></pre></div></div><p>Once this is up and running, you should be able to interact with your
service and add messages.</p><h2 id=headline-17>References</h2><ol><li><p><a href=https://github.com/m-abdelwahab/nextjs-prisma-workshop>https://github.com/m-abdelwahab/nextjs-prisma-workshop</a></p></li><li><p><a href=https://nextjs.org/docs/deployment>https://nextjs.org/docs/deployment</a></p></li></ol></article></div><div class="bg-light py-5"><div class=container><h2 class=text-center>Read next</h2><div class=row><div class="col-md-6 text-center">Next Post:
<a href=../../../articles/2021/setting_up_knative_eventing/>Setting up knative eventing</a></div><div class="col-md-6 text-center">Previous Post:
<a href=../../../articles/2021/serving_a_knative_function_on_the_root/>Serving a knative function on the root</a></div></div></div></div><div class="container mt-5"><h2 class=text-center>See also</h2><div class=row><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/serving_a_knative_function_on_the_root/>Serving a knative function on the root</a></p><p class="lead font-italic mb-0">root to services</p><div class="font-weight-light mt-3"><p>I want to deploy everything as a knative service, including the root of the domain. Update: I found an easyier way. Easy way Turn on auto-tls and autocreate-cluster-domain-claims: kubectl patch configmap config-network --namespace knative-serving -p '{"data":{"auto-tls":"Enabled","autocreate-cluster-domain-claims":"true"}}' Then kn domain create gitgratitude.com --ref=homepage That's it. Hardway Left here for the record. Add ingress-nginx helm upgrade --install ingress-nginx ingress-nginx \ --repo https://kubernetes.</p></div><a href=../../../articles/2021/serving_a_knative_function_on_the_root/ class="btn btn-primary">Read more</a></div><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/logging_with_an_http_proxy/>Logging with an HTTP Proxy</a></p><p class="lead font-italic mb-0">Simple MITM debugging</p><div class="font-weight-light mt-3"><p>I miss having Chrome dev tools when writing node applications, since I often want to see what exactly the network traffic. Here's a way to easily setup a man in the middle proxy to look at all the traffic your application is generating. Run the docker instance First we first up the proxy with the web interface: docker run --rm -it -p 8080:8080 -p 8081:8081 mitmproxy/mitmproxy mitmweb --web-host 0.</p></div><a href=../../../articles/2021/logging_with_an_http_proxy/ class="btn btn-primary">Read more</a></div><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2020/simple_cors_workaround_for_local_development/>Simple CORS workaround for local development</a></p><div class="font-weight-light mt-3"><p>I've been doing a lot of web development old school, just editing HTML and JavaScript by hand without a build environment. Running npx live-server is an easy one liner to spin up a server, that opens a browser for you and also updates changes on safe. Sometimes that's not enough. Often you want to pull in data from an API, and that requires HTTPS, and also you need to work around CORS limitations.</p></div><a href=../../../articles/2020/simple_cors_workaround_for_local_development/ class="btn btn-primary">Read more</a></div></div></div><footer class="footer bg-dark text-light mt-3"><div class=container><h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2></div></footer></body></html>