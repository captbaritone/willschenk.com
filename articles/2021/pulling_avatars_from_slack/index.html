<!doctype html><html><head><title>Pulling avatars from slack</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=../../../css/theme.css><link rel=stylesheet href=../../../css/syntax.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-56296045-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script async defer data-domain=willschenk.com src=https://plausible.io/js/plausible.js></script><meta property="og:title" content="Pulling avatars from slack"><meta property="og:description" content="Create a slack app   First we need to create a slack application.  Create a new app, and add the following scopes    users:read.email    users:read    users.profile:read    chat:write:bot Manifest     We are going to use a manifest, so we can tweak things as we go. _metadata:major_version:1display_information:name:HappyFunCorpAppsettings:org_deploy_enabled:falsesocket_mode_enabled:falseis_hosted:falsetoken_rotation_enabled:false  Create the database and schema  npm install prisma npx prisma init   Setup the schema in prisma/schema."><meta property="og:type" content="article"><meta property="og:url" content="https://willschenk.com/articles/2021/pulling_avatars_from_slack/"><meta property="article:published_time" content="2021-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-19T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pulling avatars from slack"><meta name=twitter:description content="Create a slack app   First we need to create a slack application.  Create a new app, and add the following scopes    users:read.email    users:read    users.profile:read    chat:write:bot Manifest     We are going to use a manifest, so we can tweak things as we go. _metadata:major_version:1display_information:name:HappyFunCorpAppsettings:org_deploy_enabled:falsesocket_mode_enabled:falseis_hosted:falsetoken_rotation_enabled:false  Create the database and schema  npm install prisma npx prisma init   Setup the schema in prisma/schema."><meta name=twitter:site content="@wschenk"><style>.article p,.article ul,.article ol,.article table{max-width:45em}.article pre p{max-width:none;margin-top:-1.5rem}article.article p:first-child,.article blockquote{font-size:1.25em;font-weight:300;max-width:36em}.half-height-scroll{max-height:32em;overflow:scroll}</style></head><body><nav class="container my-5"><h1 class="pt-md-5 display-3"><a class=text-dark href=../../../>Will Schenk</a></h1><p><a class="text-dark h4 mr-3 font-weight-light" href=../../../articles/>Articles</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../contact>Contact</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../tags/>Tags</a>
<a href=../../../feed.xml class="mr-3 h4 text-light"><img src=../../../img/rss.svg alt=rss height=20 width=20></a>
<a href=https://twitter.com/@wschenk class="mr-3 h4 text-light"><img src=../../../img/twitter.svg alt=twitter height=20 width=20></a>
<a href=https://instagram.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/instagram.svg alt=instagram height=20 width=20></a>
<a href=https://github.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/github.svg alt=github height=20 width=20></a>
<a href=https://linkedin.com/in/will-schenk-420266 class="mr-3 h4 text-light"><img src=../../../img/linkedin.svg alt=linkedin height=20 width=20></a></p></nav><div class=container><h1 class=mt-5>Pulling avatars from slack</h1><h2 class="font-weight-light font-italic mb-3">Basic bot integration</h2><p class="text-muted mt-3"><a class=text-muted href=https://willschenk.com/articles/2021/pulling_avatars_from_slack/>Published December 19, 2021</a>
<a class=text-muted href=../../../tags/slack>#slack,</a>
<a class=text-muted href=../../../tags/nextjs>#nextjs,</a>
<a class=text-muted href=../../../tags/bot>#bot</a></p><article class="article mt-5"><h2 id=headline-1>Create a slack app</h2><p>First we need to <a href=https://api.slack.com/authentication/basics>create a slack application</a>.</p><p>Create a new app, and add the following scopes</p><ul><li><p><code class=verbatim>users:read.email</code></p></li><li><p><code class=verbatim>users:read</code></p></li><li><p><code class=verbatim>users.profile:read</code></p></li><li><p><code class=verbatim>chat:write:bot</code></p><h3 id=headline-2>Manifest</h3></li></ul><p>We are going to use a
manifest, so we can tweak things as we go.</p><div class="src src-yaml"><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>  </span><span class=k>_metadata</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>major_version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span><span class=w>  </span><span class=k>display_information</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>name</span><span class=p>:</span><span class=w> </span>HappyFunCorp<span class=w> </span>App<span class=w>
</span><span class=w>  </span><span class=k>settings</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>org_deploy_enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>    </span><span class=k>socket_mode_enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>    </span><span class=k>is_hosted</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>    </span><span class=k>token_rotation_enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span></code></pre></div></div><h2 id=headline-3>Create the database and schema</h2><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npm install prisma
  npx prisma init</code></pre></div></div><p>Setup the schema in <code class=verbatim>prisma/schema.prisma</code></p><div class="src src-text"><div class=highlight><pre class=chroma><code class=language-text data-lang=text>  generator client {
    provider = &#34;prisma-client-js&#34;
  }

  datasource db {
    provider = &#34;postgresql&#34;
    url      = env(&#34;DATABASE_URL&#34;)
  }

  model SlackUser {
    id           String       @id
    name         String
    email        String?
    deleted      Boolean
    admin        Boolean?
    restricted   Boolean?
    bot          Boolean
    tz           String?
    title        String?
    skype        String?
    real_name    String?
    display_name String?
    status_text  String?
    status_emoji String?
    custom_image Boolean?
    original_image String?
    }</code></pre></div></div><p>Start a database if you don't have one</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  docker run -d -e <span class=nv>POSTGRES_PASSWORD</span><span class=o>=</span>awesome_password -p 5432:5432 postgres</code></pre></div></div><p>And create the migrations</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npx prisma migrate dev --name init</code></pre></div></div><h2 id=headline-4>Installing <code class=verbatim>@slack/bolt</code></h2><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>npm install @slack/bot dotenv</code></pre></div></div><h2 id=headline-5><code class=verbatim>users-list.js</code></h2><div class="src src-javascript"><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>App</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@slack/bolt&#39;</span><span class=p>);</span>
  <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;dotenv&#39;</span><span class=p>).</span><span class=nx>config</span><span class=p>()</span>
  <span class=kr>const</span> <span class=p>{</span> <span class=nx>PrismaClient</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@prisma/client&#39;</span><span class=p>)</span>
  <span class=kr>const</span> <span class=nx>prisma</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PrismaClient</span><span class=p>()</span>

  <span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>

  <span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>App</span><span class=p>({</span>
    <span class=nx>signingSecret</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SLACK_SIGNING_SECRET</span><span class=p>,</span>
    <span class=nx>token</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SLACK_BOT_TOKEN</span><span class=p>,</span>
  <span class=p>});</span>

  <span class=p>(</span><span class=nx>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span> <span class=s2>&#34;Getting user list from slack&#34;</span> <span class=p>)</span>
      <span class=kr>const</span> <span class=nx>slackdata</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>app</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>list</span><span class=p>()</span>


      <span class=k>if</span><span class=p>(</span> <span class=nx>slackdata</span><span class=p>[</span><span class=s2>&#34;ok&#34;</span><span class=p>]</span> <span class=p>)</span> <span class=p>{</span>
          <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>[]</span>
          <span class=nx>slackdata</span><span class=p>[</span><span class=s2>&#34;members&#34;</span><span class=p>].</span><span class=nx>map</span><span class=p>(</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>            
              <span class=nx>data</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
                  <span class=nx>id</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>],</span>
                  <span class=nx>name</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>],</span>
                  <span class=nx>email</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;email&#34;</span><span class=p>],</span>
                  <span class=nx>deleted</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;deleted&#34;</span><span class=p>],</span>
                  <span class=nx>admin</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;is_admin&#34;</span><span class=p>],</span>
                  <span class=nx>restricted</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;is_restricted&#34;</span><span class=p>],</span>
                  <span class=nx>bot</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;is_bot&#34;</span><span class=p>],</span>
                  <span class=nx>tz</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;tz&#34;</span><span class=p>],</span>
                  <span class=nx>title</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;title&#34;</span><span class=p>],</span>
                  <span class=nx>skype</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;skype&#34;</span><span class=p>],</span>
                  <span class=nx>real_name</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;real_name&#34;</span><span class=p>],</span>
                  <span class=nx>display_name</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;display_name&#34;</span><span class=p>],</span>
                  <span class=nx>status_text</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;status_text&#34;</span><span class=p>],</span>
                  <span class=nx>status_email</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;status_email&#34;</span><span class=p>],</span>
                  <span class=nx>status_emoji</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;status_emoji&#34;</span><span class=p>],</span>
                  <span class=nx>custom_image</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;is_custom_image&#34;</span><span class=p>],</span>
                  <span class=nx>original_image</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s2>&#34;profile&#34;</span><span class=p>][</span><span class=s2>&#34;image_original&#34;</span><span class=p>],</span>
              <span class=p>})</span>
          <span class=p>})</span>

          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span> <span class=sb>`Found </span><span class=si>${</span><span class=nx>data</span><span class=p>.</span><span class=nx>length</span><span class=si>}</span><span class=sb> accounts, updating database`</span> <span class=p>);</span>

          <span class=k>while</span><span class=p>(</span> <span class=nx>data</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=p>)</span> <span class=p>{</span>
              <span class=kr>const</span> <span class=nx>e</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>pop</span><span class=p>();</span>

              <span class=c1>// console.log( `Updating/created ${e[&#39;name&#39;]}` )
</span><span class=c1></span>
              <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>prisma</span><span class=p>.</span><span class=nx>slackUser</span><span class=p>.</span><span class=nx>upsert</span><span class=p>({</span>
                  <span class=nx>where</span><span class=o>:</span> <span class=p>{</span> <span class=nx>id</span><span class=o>:</span> <span class=nx>e</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=p>},</span>
                  <span class=nx>update</span><span class=o>:</span> <span class=nx>e</span><span class=p>,</span>
                  <span class=nx>create</span><span class=o>:</span> <span class=nx>e</span>
              <span class=p>})</span>

          <span class=p>}</span>

          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span> <span class=s2>&#34;Done&#34;</span> <span class=p>);</span>
      <span class=p>}</span>
  <span class=p>})();</span>
</code></pre></div></div><h2 id=headline-6>Create a <code class=verbatim>nextjs</code> app</h2><h3 id=headline-7>Base</h3><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npm install next react react-dom</code></pre></div></div><p>Update <code class=verbatim>package.json</code>:</p><div class="src src-json"><div class=highlight><pre class=chroma><code class=language-json data-lang=json>  <span class=p>{</span>
      <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
          <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;next dev&#34;</span><span class=p>,</span>
          <span class=nt>&#34;build&#34;</span><span class=p>:</span> <span class=s2>&#34;next build&#34;</span><span class=p>,</span>
          <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;next start&#34;</span><span class=p>,</span>
          <span class=nt>&#34;lint&#34;</span><span class=p>:</span> <span class=s2>&#34;next lint&#34;</span>
      <span class=p>}</span>
  <span class=p>}</span></code></pre></div></div><p>And then create a sample <code class=verbatim>pages/index.js</code></p><div class="src src-javascript"><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>PrismaClient</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@prisma/client&#34;</span><span class=p>);</span>
  <span class=kr>const</span> <span class=nx>prisma</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PrismaClient</span><span class=p>();</span>
  <span class=kr>const</span> <span class=p>{</span> <span class=nx>MessageSender</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../components/messageSender&#34;</span><span class=p>);</span>

  <span class=kd>function</span> <span class=nx>Home</span><span class=p>({</span> <span class=nx>users</span> <span class=p>})</span> <span class=p>{</span>
    <span class=k>return</span> <span class=p>(</span>
      <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;d-flex flex-wrap justify-content-around&#34;</span><span class=o>&gt;</span>
          <span class=p>{</span><span class=nx>users</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>u</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span>
            <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>u</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;card mt-3&#34;</span> <span class=nx>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>width</span><span class=o>:</span> <span class=s2>&#34;18rem&#34;</span> <span class=p>}}</span><span class=o>&gt;</span>
              <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;card-body&#34;</span><span class=o>&gt;</span>
                <span class=p>{</span><span class=nx>u</span><span class=p>.</span><span class=nx>custom_image</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
                  <span class=o>&lt;</span><span class=nx>img</span> <span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>u</span><span class=p>.</span><span class=nx>original_image</span><span class=p>}</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;card-img-top&#34;</span> <span class=o>/&gt;</span>
                <span class=p>)}</span>
                <span class=o>&lt;</span><span class=nx>h5</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;card-title&#34;</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>u</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/h5&gt;</span>
                <span class=o>&lt;</span><span class=nx>p</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;card-text&#34;</span><span class=o>&gt;</span>
                  <span class=p>{</span><span class=nx>u</span><span class=p>.</span><span class=nx>real_name</span><span class=p>}</span>
                  <span class=o>&lt;</span><span class=nx>br</span> <span class=o>/&gt;</span>
                  <span class=p>{</span><span class=nx>u</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span>
                  <span class=o>&lt;</span><span class=nx>br</span> <span class=o>/&gt;</span>
                  <span class=o>&lt;</span><span class=nx>a</span> <span class=nx>href</span><span class=o>=</span><span class=p>{</span><span class=sb>`mailto:</span><span class=si>${</span><span class=nx>u</span><span class=p>.</span><span class=nx>email</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>u</span><span class=p>.</span><span class=nx>email</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/a&gt;</span>
                <span class=o>&lt;</span><span class=err>/p&gt;</span>
                <span class=o>&lt;</span><span class=nx>MessageSender</span> <span class=nx>user</span><span class=o>=</span><span class=p>{</span><span class=nx>u</span><span class=p>}</span> <span class=o>/&gt;</span>
              <span class=o>&lt;</span><span class=err>/div&gt;</span>
            <span class=o>&lt;</span><span class=err>/div&gt;</span>
          <span class=p>))}</span>
        <span class=o>&lt;</span><span class=err>/div&gt;</span>
      <span class=o>&lt;</span><span class=err>/div&gt;</span>
    <span class=p>);</span>
  <span class=p>}</span>

  <span class=kr>export</span> <span class=nx>async</span> <span class=kd>function</span> <span class=nx>getServerSideProps</span><span class=p>(</span><span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>users</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>prisma</span><span class=p>.</span><span class=nx>slackUser</span><span class=p>.</span><span class=nx>findMany</span><span class=p>({</span>
      <span class=nx>where</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>deleted</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
        <span class=nx>restricted</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
      <span class=p>},</span>
    <span class=p>});</span>

    <span class=k>return</span> <span class=p>{</span>
      <span class=nx>props</span><span class=o>:</span> <span class=p>{</span> <span class=nx>users</span> <span class=p>},</span> <span class=c1>// will be passed to the page component as props
</span><span class=c1></span>    <span class=p>};</span>
  <span class=p>}</span>
  <span class=kr>export</span> <span class=k>default</span> <span class=nx>Home</span><span class=p>;</span>
</code></pre></div></div><p>And also the <code class=verbatim>MessageSender</code> component in <code class=verbatim>components/messageSender.jsx</code>:</p><div class="src src-javascript"><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript>  <span class=kr>export</span> <span class=kr>const</span> <span class=nx>MessageSender</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>user</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>return</span> <span class=p>(</span>
      <span class=o>&lt;</span><span class=nx>form</span> <span class=nx>action</span><span class=o>=</span><span class=s2>&#34;/api/sendMessage&#34;</span> <span class=nx>method</span><span class=o>=</span><span class=s2>&#34;get&#34;</span><span class=o>&gt;</span>
        <span class=o>&lt;</span><span class=nx>input</span>
          <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;text&#34;</span>
          <span class=nx>name</span><span class=o>=</span><span class=s2>&#34;message&#34;</span>
          <span class=nx>placeholder</span><span class=o>=</span><span class=p>{</span><span class=sb>`message to </span><span class=si>${</span><span class=nx>user</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>}</span>
        <span class=o>/&gt;</span>
        <span class=o>&lt;</span><span class=nx>input</span> <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;hidden&#34;</span> <span class=nx>name</span><span class=o>=</span><span class=s2>&#34;id&#34;</span> <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span> <span class=o>/&gt;</span>
        <span class=o>&lt;</span><span class=nx>button</span> <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;submit&#34;</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;btn-primary&#34;</span><span class=o>&gt;</span>
          <span class=nx>Send</span>
        <span class=o>&lt;</span><span class=err>/button&gt;</span>
      <span class=o>&lt;</span><span class=err>/form&gt;</span>
    <span class=p>);</span>
  <span class=p>};</span>
</code></pre></div></div><h3 id=headline-8>Sending a message</h3><p>Lets create the api call to actually send the message:</p><div class="src src-javascript"><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>App</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@slack/bolt&#34;</span><span class=p>);</span>

  <span class=kr>export</span> <span class=k>default</span> <span class=nx>async</span> <span class=kd>function</span> <span class=nx>handler</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>App</span><span class=p>({</span>
      <span class=nx>signingSecret</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SLACK_SIGNING_SECRET</span><span class=p>,</span>
      <span class=nx>token</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SLACK_BOT_TOKEN</span><span class=p>,</span>
    <span class=p>});</span>

    <span class=kr>const</span> <span class=p>{</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>message</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>;</span>

    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Sending </span><span class=si>${</span><span class=nx>message</span><span class=si>}</span><span class=sb> to </span><span class=si>${</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>

    <span class=k>if</span> <span class=p>(</span><span class=nx>id</span> <span class=o>&amp;&amp;</span> <span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// Call the chat.postMessage method using the WebClient
</span><span class=c1></span>        <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>app</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nx>chat</span><span class=p>.</span><span class=nx>postMessage</span><span class=p>({</span>
          <span class=nx>channel</span><span class=o>:</span> <span class=nx>id</span><span class=p>,</span>
          <span class=nx>text</span><span class=o>:</span> <span class=nx>message</span><span class=p>,</span>
        <span class=p>});</span>

        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>

        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>ok</span><span class=o>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>ok</span> <span class=p>});</span>
      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>result</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>toString</span><span class=p>()</span> <span class=p>});</span>
      <span class=p>}</span>

      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>message</span><span class=p>,</span> <span class=nx>action</span><span class=o>:</span> <span class=s2>&#34;Sent&#34;</span> <span class=p>});</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>json</span><span class=p>({</span> <span class=nx>action</span><span class=o>:</span> <span class=s2>&#34;Not Sent&#34;</span><span class=p>,</span> <span class=nx>reason</span><span class=o>:</span> <span class=s2>&#34;Missing params&#34;</span> <span class=p>});</span>
    <span class=p>}</span>
  <span class=p>}</span>
</code></pre></div></div><h3 id=headline-9>Styling</h3><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  npm install bootstrap</code></pre></div></div><p><code class=verbatim>pages/_app.js</code>:</p><div class="src src-javascript"><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript>  <span class=c1>// pages/_app.js
</span><span class=c1></span>  <span class=kr>import</span> <span class=s1>&#39;bootstrap/dist/css/bootstrap.css&#39;</span>

  <span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>MyApp</span><span class=p>({</span> <span class=nx>Component</span><span class=p>,</span> <span class=nx>pageProps</span> <span class=p>})</span> <span class=p>{</span>
      <span class=k>return</span> <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;container&#34;</span><span class=o>&gt;</span>
          <span class=o>&lt;</span><span class=nx>Component</span> <span class=p>{...</span><span class=nx>pageProps</span><span class=p>}</span> <span class=o>/&gt;</span>
          <span class=o>&lt;</span><span class=err>/div&gt;</span>
  <span class=p>}</span>
</code></pre></div></div><h2 id=headline-10>References</h2></article></div><div class="bg-light py-5"><div class=container><h2 class=text-center>Read next</h2><div class=row><div class="col-md-6 text-center">Next Post:
<a href=../../../articles/2022/using_active_record_outside_of_rails/>Using ActiveRecord outside of rails</a></div><div class="col-md-6 text-center">Previous Post:
<a href=../../../articles/2021/setting_up_digital_ocean_spaces_to_upload/>Setting up digital ocean spaces to upload</a></div></div></div></div><div class="container mt-5"><h2 class=text-center>See also</h2><div class=row><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/receiving_cloud_events_with_next_js/>Receiving CloudEvents with NextJS</a></p><div class="font-weight-light mt-3"><p>Need to receive cloudevents from your NextJS app? Me too! You need next-runtime. Install npm i next-runtime cloudevents In pages/indes.ts And then: import { handle, json } from 'next-runtime'; import { HTTP } from 'cloudevents'; export const getServerSideProps = handle({ async post({ req }) { console.log( req.body ) console.log( req.headers ) const receivedEvent = HTTP.toEvent({headers: req.headers, body: req.body }) console.log( receivedEvent ) return json({ message: 'Thanks for your submission!</p></div><a href=../../../articles/2021/receiving_cloud_events_with_next_js/ class="btn btn-primary">Read more</a></div><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2021/next_js_with_prisma/>NextJS with Prisma on Kubernetes</a></p><p class="lead font-italic mb-0">deploy as a knative service</p><div class="font-weight-light mt-3"><p>Now that we have our cluster up and running, lets look at how to build and deploy a NextJS app on it, including the database. Create a NextJS app We'll scaffold out a TypeScript app. npx create-next-app@latest --typescript myapp cd myapp npm run dev Fireup a local data docker run -e POSTGRES_PASSWORD=awesome_password -p 5432:5432 postgres Install prisma We'll add the npm packages to our project.</p></div><a href=../../../articles/2021/next_js_with_prisma/ class="btn btn-primary">Read more</a></div></div></div><footer class="footer bg-dark text-light mt-3"><div class=container><h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2></div></footer></body></html>